<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Windows 11</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
    
    body {
      height: 100vh;
      overflow: hidden;
      background: #000;
      user-select: none;
    }

    /* BIOS Screen */
    .bios-screen {
      position: fixed;
      inset: 0;
      background: #000;
      color: #aaa;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      padding: 20px;
      z-index: 1000;
      overflow: hidden;
    }

    .bios-header {
      color: #fff;
      background: #0000aa;
      padding: 5px 10px;
      margin-bottom: 20px;
    }

    .bios-line {
      margin: 3px 0;
      opacity: 0;
      animation: biosType 0.05s forwards;
    }

    @keyframes biosType {
      to { opacity: 1; }
    }

    .bios-progress {
      margin-top: 20px;
      color: #0f0;
    }

    /* Boot Logo Screen */
    .boot-screen {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .manufacturer-logo {
      font-size: 48px;
      color: #fff;
      margin-bottom: 30px;
      opacity: 0;
      animation: fadeInOut 2s forwards;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; }
      30% { opacity: 1; }
      70% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Windows Loading Screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 998;
    }

    .windows-logo {
      width: 100px;
      height: 100px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      margin-bottom: 40px;
    }

    .win-square {
      background: #0078d4;
      border-radius: 2px;
      animation: winPulse 2s ease-in-out infinite;
    }

    .win-square:nth-child(1) { animation-delay: 0s; }
    .win-square:nth-child(2) { animation-delay: 0.1s; }
    .win-square:nth-child(3) { animation-delay: 0.2s; }
    .win-square:nth-child(4) { animation-delay: 0.3s; }

    @keyframes winPulse {
      0%, 100% { opacity: 0.3; transform: scale(0.95); }
      50% { opacity: 1; transform: scale(1); }
    }

    .loading-dots {
      display: flex;
      gap: 8px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      background: #fff;
      border-radius: 50%;
      animation: dotSpin 1.5s ease-in-out infinite;
    }

    .loading-dot:nth-child(1) { animation-delay: 0s; }
    .loading-dot:nth-child(2) { animation-delay: 0.15s; }
    .loading-dot:nth-child(3) { animation-delay: 0.3s; }
    .loading-dot:nth-child(4) { animation-delay: 0.45s; }
    .loading-dot:nth-child(5) { animation-delay: 0.6s; }

    @keyframes dotSpin {
      0% { transform: translateY(0); opacity: 0.3; }
      50% { transform: translateY(-10px); opacity: 1; }
      100% { transform: translateY(0); opacity: 0.3; }
    }

    .loading-text {
      color: #fff;
      margin-top: 30px;
      font-size: 14px;
      opacity: 0;
      animation: fadeIn 0.5s forwards 1s;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* Lock Screen */
    .lock-screen {
      position: fixed;
      inset: 0;
      background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920') center/cover;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      padding-bottom: 100px;
      z-index: 997;
      cursor: pointer;
    }

    .lock-time {
      position: absolute;
      bottom: 150px;
      left: 50px;
      color: #fff;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .lock-time .time {
      font-size: 96px;
      font-weight: 300;
    }

    .lock-time .date {
      font-size: 24px;
      font-weight: 300;
    }

    .lock-hint {
      color: #fff;
      font-size: 14px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* Login Screen */
    .login-screen {
      position: fixed;
      inset: 0;
      background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920') center/cover;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 996;
    }

    .login-screen::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(20px);
    }

    .login-box {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .user-avatar-large {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      color: #fff;
      margin-bottom: 10px;
    }

    .user-name-large {
      color: #fff;
      font-size: 28px;
      font-weight: 300;
    }

    .password-box {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .password-input {
      width: 250px;
      padding: 12px 15px;
      border: none;
      border-radius: 4px;
      background: rgba(255,255,255,0.9);
      font-size: 14px;
    }

    .password-input:focus { outline: none; }

    .submit-btn {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 4px;
      background: rgba(255,255,255,0.9);
      cursor: pointer;
      font-size: 16px;
    }

    .submit-btn:hover { background: #fff; }

    .login-options {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .login-option {
      color: #fff;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .login-option:hover { opacity: 0.8; }

    /* Welcome Screen */
    .welcome-screen {
      position: fixed;
      inset: 0;
      background: #0078d4;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 995;
      color: #fff;
    }

    .welcome-text {
      font-size: 42px;
      font-weight: 300;
      margin-bottom: 40px;
    }

    .welcome-dots {
      display: flex;
      gap: 8px;
    }

    .welcome-dot {
      width: 10px;
      height: 10px;
      background: rgba(255,255,255,0.5);
      border-radius: 50%;
      animation: welcomePulse 1.5s ease-in-out infinite;
    }

    .welcome-dot:nth-child(1) { animation-delay: 0s; }
    .welcome-dot:nth-child(2) { animation-delay: 0.2s; }
    .welcome-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes welcomePulse {
      0%, 100% { background: rgba(255,255,255,0.3); }
      50% { background: rgba(255,255,255,1); }
    }

    /* Desktop */
    .desktop-container {
      display: none;
      height: 100vh;
      background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920') center/cover;
      animation: desktopFadeIn 0.8s ease;
    }

    @keyframes desktopFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .desktop {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      height: calc(100vh - 48px);
    }

    .icon {
      width: 80px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .icon:hover { background: rgba(255,255,255,0.2); }
    .icon:active { background: rgba(255,255,255,0.3); }

    .icon-img {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .icon span {
      color: white;
      font-size: 12px;
      text-align: center;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }

    /* Taskbar */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: rgba(32, 32, 32, 0.85);
      backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 10px;
      z-index: 100;
    }

    .taskbar-center {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    .taskbar-btn {
      width: 44px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 20px;
    }

    .taskbar-btn:hover { background: rgba(255,255,255,0.1); }

    .start-btn {
      background: linear-gradient(135deg, #0078d4, #00bcf2);
      border-radius: 4px;
    }

    .taskbar-right {
      position: absolute;
      right: 10px;
      display: flex;
      align-items: center;
      gap: 5px;
      color: white;
      font-size: 12px;
    }

    .system-tray {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }

    .system-tray:hover { background: rgba(255,255,255,0.1); }

    .clock {
      text-align: center;
      padding: 4px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .clock:hover { background: rgba(255,255,255,0.1); }

    /* Start Menu */
    .start-menu {
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%) scale(0.95);
      width: 600px;
      height: 650px;
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }

    .start-menu.open {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) scale(1);
    }

    .start-content {
      padding: 40px 50px;
      color: white;
    }

    .search-box {
      width: 100%;
      padding: 10px 15px;
      border-radius: 20px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 14px;
      margin-bottom: 30px;
    }

    .search-box::placeholder { color: rgba(255,255,255,0.5); }
    .search-box:focus { outline: none; background: rgba(255,255,255,0.15); }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .pinned-apps {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 5px;
      margin-bottom: 30px;
    }

    .app-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 12px 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .app-item:hover { background: rgba(255,255,255,0.1); }

    .app-item .icon-img { font-size: 28px; }
    .app-item span { font-size: 11px; color: rgba(255,255,255,0.9); }

    .recommended {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 5px;
    }

    .rec-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .rec-item:hover { background: rgba(255,255,255,0.1); }
    .rec-item .icon-img { font-size: 24px; }
    .rec-info span { display: block; font-size: 12px; }
    .rec-info .time { color: rgba(255,255,255,0.5); font-size: 11px; }

    .user-section {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 15px 50px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.2);
      color: white;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .user-profile:hover { background: rgba(255,255,255,0.1); }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .power-btn {
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
    }

    .power-btn:hover { background: rgba(255,255,255,0.1); }

    /* Window */
    .window {
      position: fixed;
      width: 800px;
      height: 500px;
      background: #1e1e1e;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      display: none;
      z-index: 50;
    }

    .window.open { display: block; animation: windowOpen 0.2s ease; }

    @keyframes windowOpen {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .window-header {
      height: 32px;
      background: #2d2d2d;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
    }

    .window-title {
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .window-controls { display: flex; }

    .win-btn {
      width: 46px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
      cursor: pointer;
    }

    .win-btn:hover { background: rgba(255,255,255,0.1); }
    .win-btn.close:hover { background: #e81123; }

    .window-body {
      height: calc(100% - 32px);
      background: #1e1e1e;
      color: white;
      padding: 20px;
      overflow: auto;
    }

    .explorer-body {
      display: flex;
      height: 100%;
      padding: 0;
    }

    .sidebar {
      width: 200px;
      background: #2d2d2d;
      padding: 10px;
    }

    .sidebar-item {
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: white;
    }

    .sidebar-item:hover { background: rgba(255,255,255,0.1); }
    .sidebar-item.active { background: rgba(255,255,255,0.15); }

    .explorer-main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .explorer-toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #252525;
      border-bottom: 1px solid #3a3a3a;
    }

    .nav-btn {
      width: 28px;
      height: 28px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #fff;
      font-size: 14px;
      transition: background 0.2s;
    }

    .nav-btn:hover { background: rgba(255,255,255,0.1); }
    .nav-btn.disabled { opacity: 0.3; pointer-events: none; }

    .address-bar {
      flex: 1;
      display: flex;
      align-items: center;
      background: #1e1e1e;
      border-radius: 4px;
      padding: 6px 12px;
      gap: 6px;
    }

    .address-bar span {
      color: #888;
      font-size: 13px;
    }

    .path-text {
      color: #fff !important;
      font-size: 13px;
    }

    .explorer-content {
      flex: 1;
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 10px;
      align-content: start;
      overflow-y: auto;
    }

    .folder-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
    }

    .folder-item:hover { background: rgba(255,255,255,0.1); }
    .folder-item.selected { background: rgba(0,120,212,0.3); }
    .folder-item span { font-size: 12px; color: white; text-align: center; word-break: break-word; }

    /* Context Menu */
    .context-menu {
      position: fixed;
      background: rgba(45, 45, 45, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 8px;
      padding: 5px;
      min-width: 200px;
      display: none;
      z-index: 200;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }

    .context-menu.open { display: block; }

    .context-item {
      padding: 8px 12px;
      color: white;
      font-size: 13px;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .context-item:hover { background: rgba(255,255,255,0.1); }

    .context-divider {
      height: 1px;
      background: rgba(255,255,255,0.1);
      margin: 5px 0;
    }

    /* Shutdown Screen */
    .shutdown-screen {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .shutdown-text {
      color: #fff;
      font-size: 24px;
      margin-bottom: 30px;
    }

    /* Browser Styles */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .browser-tab {
      cursor: pointer;
      transition: background 0.2s;
    }

    .browser-tab:hover {
      background: #333 !important;
    }

    .quick-links {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      max-width: 500px;
      margin: 30px auto;
    }

    .quick-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 15px;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .quick-link:hover {
      background: rgba(0,0,0,0.05);
    }

    .quick-link-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .quick-link span {
      font-size: 12px;
      color: #333;
    }

    /* Calendar Popup */
    .calendar-popup {
      position: fixed;
      bottom: 60px;
      right: 10px;
      width: 320px;
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      padding: 20px;
      display: none;
      z-index: 150;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      color: white;
    }
    .calendar-popup.open { display: block; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .calendar-nav { cursor: pointer; padding: 5px 10px; border-radius: 4px; }
    .calendar-nav:hover { background: rgba(255,255,255,0.1); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center; }
    .calendar-day { padding: 8px; border-radius: 50%; cursor: pointer; font-size: 13px; }
    .calendar-day:hover { background: rgba(255,255,255,0.1); }
    .calendar-day.today { background: #0078d4; }
    .calendar-day.header { font-weight: bold; color: #888; font-size: 11px; }
    .calendar-day.other-month { color: #666; }

    /* Quick Settings Panel */
    .quick-settings {
      position: fixed;
      bottom: 60px;
      right: 10px;
      width: 360px;
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      padding: 20px;
      display: none;
      z-index: 150;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      color: white;
    }
    .quick-settings.open { display: block; }
    .qs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
    .qs-btn { padding: 15px 10px; border-radius: 8px; background: #3d3d3d; cursor: pointer; text-align: center; transition: all 0.2s; }
    .qs-btn:hover { background: #4d4d4d; }
    .qs-btn.active { background: #0078d4; }
    .qs-btn span { display: block; font-size: 20px; margin-bottom: 5px; }
    .qs-btn small { font-size: 11px; color: #aaa; }
    .qs-slider { margin: 15px 0; }
    .qs-slider label { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 13px; }
    .qs-slider input[type="range"] { flex: 1; accent-color: #0078d4; }

    /* Taskbar App Indicators */
    .taskbar-btn.running::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 3px;
      background: #0078d4;
      border-radius: 2px;
    }
    .taskbar-btn { position: relative; }

    /* Window Resizable */
    .window { min-width: 300px; min-height: 200px; }
    .window.maximized { 
      top: 0 !important; 
      left: 0 !important; 
      width: 100% !important; 
      height: calc(100vh - 48px) !important; 
      border-radius: 0; 
    }
    .window.minimized { display: none !important; }
    .resize-handle {
      position: absolute;
      background: transparent;
    }
    .resize-handle.se { right: 0; bottom: 0; width: 15px; height: 15px; cursor: se-resize; }
    .resize-handle.sw { left: 0; bottom: 0; width: 15px; height: 15px; cursor: sw-resize; }
    .resize-handle.ne { right: 0; top: 0; width: 15px; height: 15px; cursor: ne-resize; }
    .resize-handle.nw { left: 0; top: 0; width: 15px; height: 15px; cursor: nw-resize; }
    .resize-handle.n { top: 0; left: 15px; right: 15px; height: 5px; cursor: n-resize; }
    .resize-handle.s { bottom: 0; left: 15px; right: 15px; height: 5px; cursor: s-resize; }
    .resize-handle.e { right: 0; top: 15px; bottom: 15px; width: 5px; cursor: e-resize; }
    .resize-handle.w { left: 0; top: 15px; bottom: 15px; width: 5px; cursor: w-resize; }

    /* Calculator */
    .calc-display { background: #1a1a1a; padding: 20px; text-align: right; font-size: 32px; margin-bottom: 10px; border-radius: 4px; }
    .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
    .calc-btn { padding: 18px; font-size: 18px; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
    .calc-btn.num { background: #3d3d3d; color: white; }
    .calc-btn.num:hover { background: #4d4d4d; }
    .calc-btn.op { background: #2d2d2d; color: white; }
    .calc-btn.op:hover { background: #3d3d3d; }
    .calc-btn.eq { background: #0078d4; color: white; }
    .calc-btn.eq:hover { background: #1084d8; }

    /* Terminal */
    .terminal-output { font-family: 'Consolas', monospace; font-size: 14px; white-space: pre-wrap; margin-bottom: 10px; }
    .terminal-input { display: flex; align-items: center; }
    .terminal-prompt { color: #0a0; margin-right: 8px; }
    .terminal-input input { flex: 1; background: transparent; border: none; color: white; font-family: 'Consolas', monospace; font-size: 14px; outline: none; }

    /* Task Manager */
    .task-list { margin-top: 10px; }
    .task-item { display: flex; justify-content: space-between; padding: 10px; background: #2d2d2d; margin-bottom: 5px; border-radius: 4px; align-items: center; }
    .task-item:hover { background: #3d3d3d; }
    .task-info { display: flex; align-items: center; gap: 10px; }
    .task-end { padding: 5px 10px; background: #e81123; border: none; color: white; border-radius: 4px; cursor: pointer; font-size: 12px; }

    /* Widgets Panel */
    .widgets-panel {
      position: fixed;
      top: 0;
      left: -400px;
      width: 400px;
      height: calc(100vh - 48px);
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      transition: left 0.3s ease;
      z-index: 90;
      padding: 20px;
      overflow-y: auto;
      color: white;
    }
    .widgets-panel.open { left: 0; }
    .widget-card { background: #2d2d2d; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
    .widget-title { font-size: 14px; font-weight: 600; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    .weather-main { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
    .weather-temp { font-size: 48px; font-weight: 300; }
    .weather-icon { font-size: 48px; }
    .weather-details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 12px; color: #aaa; }

    /* Paint App */
    .paint-toolbar { display: flex; gap: 10px; padding: 10px; background: #2d2d2d; align-items: center; flex-wrap: wrap; }
    .paint-colors { display: flex; gap: 5px; }
    .paint-color { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
    .paint-color.active { border-color: white; }
    .paint-canvas { background: white; cursor: crosshair; }
    .paint-sizes { display: flex; gap: 5px; align-items: center; }
    .paint-size { width: 30px; height: 30px; border-radius: 4px; background: #3d3d3d; display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; font-size: 12px; }
    .paint-size.active { background: #0078d4; }

    /* Alt+Tab Switcher */
    .alt-tab-switcher {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 12px;
      padding: 20px;
      display: none;
      z-index: 3000;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .alt-tab-switcher.open { display: flex; gap: 15px; }
    .alt-tab-item { width: 150px; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; color: white; }
    .alt-tab-item.selected { background: rgba(255,255,255,0.2); }
    .alt-tab-item span { font-size: 32px; display: block; margin-bottom: 8px; }
    .alt-tab-item small { font-size: 11px; }

    /* BSOD */
    .bsod-screen {
      position: fixed;
      inset: 0;
      background: #0078d4;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 5000;
      color: white;
      text-align: center;
      padding: 50px;
    }
    .bsod-screen.show { display: flex; }
    .bsod-sad { font-size: 120px; margin-bottom: 30px; }
    .bsod-title { font-size: 28px; margin-bottom: 20px; }
    .bsod-text { font-size: 14px; max-width: 600px; line-height: 1.6; color: rgba(255,255,255,0.8); }
    .bsod-qr { margin-top: 30px; font-size: 60px; }

    /* Lock Screen Overlay */
    .lock-overlay {
      position: fixed;
      inset: 0;
      background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920') center/cover;
      display: none;
      z-index: 2500;
    }
    .lock-overlay.show { display: flex; flex-direction: column; align-items: center; justify-content: center; }

    /* CSS Variables for Theming */
    :root {
      --bg-primary: #1e1e1e;
      --bg-secondary: #2d2d2d;
      --bg-tertiary: #252525;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent-color: #0078d4;
      --border-color: #3a3a3a;
    }
    [data-theme="light"] {
      --bg-primary: #f3f3f3;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f9f9f9;
      --text-primary: #000000;
      --text-secondary: #666666;
      --accent-color: #0078d4;
      --border-color: #e0e0e0;
    }

    /* Snap Layouts */
    .snap-layouts {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 4000;
      pointer-events: none;
    }
    .snap-layouts.show { display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 10px; padding: 10px; }
    .snap-zone {
      background: rgba(0,120,212,0.3);
      border: 2px dashed #0078d4;
      border-radius: 8px;
      pointer-events: all;
      cursor: pointer;
      transition: background 0.2s;
    }
    .snap-zone:hover { background: rgba(0,120,212,0.5); }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 60px;
      right: 20px;
      z-index: 5000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .toast {
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      padding: 15px 20px;
      min-width: 300px;
      max-width: 400px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      color: white;
      animation: toastSlideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    @keyframes toastSlideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .toast-icon { font-size: 24px; }
    .toast-content { flex: 1; }
    .toast-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
    .toast-message { font-size: 12px; color: #aaa; }
    .toast-close { cursor: pointer; opacity: 0.7; }
    .toast-close:hover { opacity: 1; }

    /* Task View / Virtual Desktops */
    .task-view {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(20px);
      display: none;
      z-index: 3000;
      padding: 40px;
    }
    .task-view.show { display: flex; flex-direction: column; }
    .desktop-thumbnail {
      width: 300px;
      height: 200px;
      background: rgba(32,32,32,0.8);
      border-radius: 8px;
      margin: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }
    .desktop-thumbnail:hover { border-color: #0078d4; transform: scale(1.05); }
    .desktop-thumbnail.active { border-color: #0078d4; }

    /* Explorer Tabs */
    .explorer-tabs { display: flex; gap: 2px; align-items: center; }
    .explorer-tab {
      padding: 8px 16px;
      background: #2d2d2d;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-size: 12px;
      color: #aaa;
      display: flex;
      align-items: center;
      gap: 6px;
      position: relative;
    }
    .explorer-tab.active { background: #1e1e1e; color: white; }
    .explorer-tab-close { margin-left: 8px; opacity: 0.7; }
    .explorer-tab-close:hover { opacity: 1; }

    /* Preview Pane */
    .preview-pane { display: none; }
    .preview-pane.show { display: block; }
    .preview-image { max-width: 100%; border-radius: 4px; }
    .preview-text { white-space: pre-wrap; font-family: Consolas, monospace; font-size: 12px; }

    /* Properties Dialog */
    .properties-dialog {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      padding: 20px;
      min-width: 400px;
      max-width: 500px;
      z-index: 2000;
      display: none;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      color: white;
    }
    .properties-dialog.show { display: block; }
    .properties-header { font-size: 18px; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .properties-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #3a3a3a; }
    .properties-label { color: #aaa; font-size: 13px; }
    .properties-value { font-size: 13px; }

    /* Photos App */
    .photos-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      padding: 15px;
    }
    .photo-thumb {
      aspect-ratio: 1;
      background: #2d2d2d;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      position: relative;
    }
    .photo-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .photo-viewer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 4000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .photo-viewer.show { display: flex; }
    .photo-viewer img { max-width: 90%; max-height: 90%; }
    .photo-nav { position: absolute; top: 50%; transform: translateY(-50%); font-size: 48px; cursor: pointer; padding: 20px; }
    .photo-nav.prev { left: 20px; }
    .photo-nav.next { right: 20px; }

    /* Media Player */
    .media-player-controls {
      background: #2d2d2d;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .media-progress {
      width: 100%;
      height: 6px;
      background: #3d3d3d;
      border-radius: 3px;
      cursor: pointer;
      position: relative;
    }
    .media-progress-bar {
      height: 100%;
      background: #0078d4;
      border-radius: 3px;
      width: 0%;
    }
    .media-buttons {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .media-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }
    .media-btn:hover { background: rgba(255,255,255,0.2); }
    .media-btn.play { background: #0078d4; }

    /* Snipping Tool */
    .snipping-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 6000;
      display: none;
      cursor: crosshair;
    }
    .snipping-overlay.active { display: block; }
    .snipping-selection {
      position: absolute;
      border: 2px dashed #0078d4;
      background: rgba(0,120,212,0.1);
      pointer-events: none;
    }
    .snipping-preview {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(32, 32, 32, 0.95);
      backdrop-filter: blur(30px);
      border-radius: 8px;
      padding: 20px;
      z-index: 6001;
      display: none;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .snipping-preview.show { display: block; }
    .snipping-preview img { max-width: 600px; max-height: 400px; border-radius: 4px; }

    /* Tooltips */
    .tooltip {
      position: absolute;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      z-index: 10000;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .tooltip.show { opacity: 1; }

    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 7000;
    }
    .loading-overlay.show { display: flex; }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top-color: #0078d4;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    /* Screensaver */
    .screensaver {
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 8000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .screensaver.active { display: flex; }
    .screensaver-content {
      color: white;
      font-size: 48px;
      animation: screensaverFloat 3s ease-in-out infinite;
    }
    @keyframes screensaverFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
  </style>
</head>
<body>
  <!-- BIOS Screen -->
  <div class="bios-screen" id="biosScreen">
    <div class="bios-header">American Megatrends BIOS v2.85</div>
    <div id="biosContent"></div>
  </div>

  <!-- Boot Logo Screen -->
  <div class="boot-screen" id="bootScreen">
    <div class="manufacturer-logo">üñ•Ô∏è ASUS</div>
  </div>

  <!-- Windows Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="windows-logo">
      <div class="win-square"></div>
      <div class="win-square"></div>
      <div class="win-square"></div>
      <div class="win-square"></div>
    </div>
    <div class="loading-dots">
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
    </div>
    <div class="loading-text" id="loadingText">Getting things ready</div>
  </div>

  <!-- Lock Screen -->
  <div class="lock-screen" id="lockScreen">
    <div class="lock-time">
      <div class="time" id="lockTime">12:00</div>
      <div class="date" id="lockDate">◊ô◊ï◊ù ◊ó◊û◊ô◊©◊ô, 18 ◊ë◊ì◊¶◊û◊ë◊®</div>
    </div>
    <div class="lock-hint">◊ú◊ó◊• ◊ê◊ï ◊î◊ß◊© ◊ú◊î◊û◊©◊ö</div>
  </div>

  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-box">
      <div class="user-avatar-large">üë§</div>
      <div class="user-name-large">◊©◊ú◊ï◊ù</div>
      <div class="password-box">
        <input type="password" class="password-input" placeholder="◊°◊ô◊°◊û◊î" id="passwordInput">
        <button class="submit-btn" onclick="login()">‚Üí</button>
      </div>
      <div class="login-options">
        <div class="login-option">üîë<span>PIN</span></div>
        <div class="login-option">üëÜ<span>◊ò◊ë◊ô◊¢◊™ ◊ê◊¶◊ë◊¢</span></div>
        <div class="login-option">üëÅÔ∏è<span>◊ñ◊ô◊î◊ï◊ô ◊§◊†◊ô◊ù</span></div>
      </div>
    </div>
  </div>

  <!-- Welcome Screen -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-text">◊ë◊®◊ï◊ö ◊î◊ë◊ê</div>
    <div class="welcome-dots">
      <div class="welcome-dot"></div>
      <div class="welcome-dot"></div>
      <div class="welcome-dot"></div>
    </div>
  </div>

  <!-- Shutdown Screen -->
  <div class="shutdown-screen" id="shutdownScreen">
    <div class="shutdown-text" id="shutdownText">◊û◊õ◊ë◊î...</div>
    <div class="loading-dots">
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
    </div>
  </div>

  <!-- Desktop -->
  <div class="desktop-container" id="desktopContainer">
    <div class="desktop">
      <div class="icon" ondblclick="openWindow('explorer')">
        <div class="icon-img">üìÅ</div>
        <span>This PC</span>
      </div>
      <div class="icon" ondblclick="openWindow('edge')">
        <div class="icon-img">üåê</div>
        <span>Edge</span>
      </div>
      <div class="icon">
        <div class="icon-img">üóëÔ∏è</div>
        <span>Recycle Bin</span>
      </div>
      <div class="icon" ondblclick="openWindow('notepad')">
        <div class="icon-img">üìù</div>
        <span>Notepad</span>
      </div>
      <div class="icon" ondblclick="openWindow('settings')">
        <div class="icon-img">‚öôÔ∏è</div>
        <span>Settings</span>
      </div>
      <div class="icon" ondblclick="openWindow('photos')">
        <div class="icon-img">üñºÔ∏è</div>
        <span>Photos</span>
      </div>
      <div class="icon" ondblclick="openWindow('mediaplayer')">
        <div class="icon-img">üéµ</div>
        <span>Media Player</span>
      </div>
      <div class="icon" ondblclick="startSnipping()">
        <div class="icon-img">‚úÇÔ∏è</div>
        <span>Snipping Tool</span>
      </div>
      <div class="icon" ondblclick="navigateTo('Recycle Bin'); openWindow('explorer')">
        <div class="icon-img">üóëÔ∏è</div>
        <span>Recycle Bin</span>
      </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
      <div class="taskbar-btn" onclick="toggleWidgets()" style="position: absolute; left: 10px;" title="Widgets">üì∞</div>
      <div class="taskbar-center">
        <div class="taskbar-btn start-btn" onclick="toggleStartMenu()" title="Start">ü™ü</div>
        <div class="taskbar-btn" onclick="showTaskView()" title="Task View">üìë</div>
        <div class="taskbar-btn" id="taskbar-edge" onclick="openWindow('edge')" title="Microsoft Edge">üåê</div>
        <div class="taskbar-btn" id="taskbar-explorer" onclick="openWindow('explorer')" title="File Explorer">üìÅ</div>
        <div class="taskbar-btn" id="taskbar-terminal" onclick="openWindow('terminal')" title="Terminal">‚¨õ</div>
        <div class="taskbar-btn" id="taskbar-notepad" onclick="openWindow('notepad')" title="Notepad">üìù</div>
      </div>
      <div class="taskbar-right">
        <div class="system-tray" onclick="toggleQuickSettings()">
          <span id="volumeIcon">üîä</span>
          <span>üì∂</span>
          <span>üîã</span>
        </div>
        <div class="clock" id="clock" onclick="toggleCalendar()">
          <div id="time">12:00</div>
          <div id="date">01/01/2024</div>
        </div>
      </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="startMenu">
      <div class="start-content">
        <input type="text" class="search-box" id="startSearch" placeholder="üîç ◊ó◊ô◊§◊ï◊© ◊ê◊§◊ú◊ô◊ß◊¶◊ô◊ï◊™, ◊î◊í◊ì◊®◊ï◊™ ◊ï◊û◊°◊û◊õ◊ô◊ù" oninput="filterApps(this.value)">
        <div class="section-title">Pinned</div>
        <div class="pinned-apps" id="pinnedApps">
          <div class="app-item" data-name="edge" onclick="openWindow('edge')"><div class="icon-img">üåê</div><span>Edge</span></div>
          <div class="app-item" data-name="explorer" onclick="openWindow('explorer')"><div class="icon-img">üìÅ</div><span>Explorer</span></div>
          <div class="app-item" data-name="terminal" onclick="openWindow('terminal')"><div class="icon-img">‚¨õ</div><span>Terminal</span></div>
          <div class="app-item" data-name="calculator" onclick="openWindow('calculator')"><div class="icon-img">üßÆ</div><span>Calculator</span></div>
          <div class="app-item" data-name="notepad" onclick="openWindow('notepad')"><div class="icon-img">üìù</div><span>Notepad</span></div>
          <div class="app-item" data-name="settings" onclick="openWindow('settings')"><div class="icon-img">‚öôÔ∏è</div><span>Settings</span></div>
          <div class="app-item" data-name="paint" onclick="openWindow('paint')"><div class="icon-img">üé®</div><span>Paint</span></div>
          <div class="app-item" data-name="photos" onclick="openWindow('photos')"><div class="icon-img">üñºÔ∏è</div><span>Photos</span></div>
          <div class="app-item" data-name="mediaplayer" onclick="openWindow('mediaplayer')"><div class="icon-img">üéµ</div><span>Media Player</span></div>
          <div class="app-item" data-name="snipping" onclick="startSnipping()"><div class="icon-img">‚úÇÔ∏è</div><span>Snipping Tool</span></div>
          <div class="app-item" data-name="taskmanager" onclick="openWindow('taskmanager')"><div class="icon-img">üìä</div><span>Task Manager</span></div>
          <div class="app-item" data-name="xbox" onclick="triggerBSOD()"><div class="icon-img">üéÆ</div><span>Xbox</span></div>
          <div class="app-item" data-name="word"><div class="icon-img">üíº</div><span>Word</span></div>
          <div class="app-item" data-name="excel"><div class="icon-img">üìà</div><span>Excel</span></div>
          <div class="app-item" data-name="powerpoint"><div class="icon-img">üìë</div><span>PowerPoint</span></div>
        </div>
        <div class="section-title">Recommended</div>
        <div class="recommended">
          <div class="rec-item"><div class="icon-img">üìÑ</div><div class="rec-info"><span>Document.docx</span><span class="time">◊ú◊§◊†◊ô ◊©◊¢◊î</span></div></div>
          <div class="rec-item"><div class="icon-img">üìä</div><div class="rec-info"><span>Budget.xlsx</span><span class="time">◊ê◊™◊û◊ï◊ú</span></div></div>
        </div>
      </div>
      <div class="user-section">
        <div class="user-profile" onclick="lockScreen()">
          <div class="user-avatar">üë§</div>
          <span style="font-size: 13px;">◊©◊ú◊ï◊ù</span>
        </div>
        <div class="power-btn" onclick="shutdown()">‚èª</div>
      </div>
    </div>

    <!-- Windows -->
    <div class="window" id="explorerWindow" style="top: 50px; left: 100px;">
      <div class="window-header" onmousedown="startDrag(event, 'explorerWindow')" ondblclick="maximizeWindow('explorer')">
        <div class="window-title"><span>üìÅ</span> File Explorer</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('explorer')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('explorer')" title="Maximize" onmouseenter="showSnapLayouts(event, 'explorer')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('explorer')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body explorer-body">
        <div class="sidebar">
          <div class="sidebar-item active" onclick="navigateTo('Desktop')" data-location="Desktop">üìÅ Desktop</div>
          <div class="sidebar-item" onclick="navigateTo('Downloads')" data-location="Downloads">‚¨áÔ∏è Downloads</div>
          <div class="sidebar-item" onclick="navigateTo('Documents')" data-location="Documents">üìÑ Documents</div>
          <div class="sidebar-item" onclick="navigateTo('Pictures')" data-location="Pictures">üñºÔ∏è Pictures</div>
          <div class="sidebar-item" onclick="navigateTo('Music')" data-location="Music">üéµ Music</div>
          <div class="sidebar-item" onclick="navigateTo('This PC')" data-location="This PC">üíª This PC</div>
          <div class="sidebar-item" onclick="navigateTo('Recycle Bin')" data-location="Recycle Bin">üóëÔ∏è Recycle Bin</div>
        </div>
        <div class="explorer-main">
          <div class="explorer-toolbar">
            <div class="nav-btn disabled" id="backBtn" onclick="goBack()" title="Back">‚Üê</div>
            <div class="nav-btn disabled" id="forwardBtn" onclick="goForward()" title="Forward">‚Üí</div>
            <div class="nav-btn" onclick="navigateTo(currentPath.split('/')[0] || 'This PC')" title="Up">‚Üë</div>
            <div class="address-bar">
              <span>üìÅ</span>
              <span class="path-text" id="pathDisplay">This PC</span>
            </div>
            <div class="nav-btn" onclick="refreshExplorer()" title="Refresh">üîÑ</div>
            <div class="nav-btn" onclick="togglePreviewPane()" title="Preview Pane" id="previewToggle">üëÅÔ∏è</div>
            <div class="nav-btn" onclick="newExplorerTab()" title="New Tab">‚ûï</div>
          </div>
          <div class="explorer-tabs" id="explorerTabs" style="display: none; background: #252525; padding: 4px 8px; border-bottom: 1px solid #3a3a3a;">
            <div class="explorer-tab active" onclick="switchExplorerTab(0)" data-tab="0">üìÅ This PC</div>
          </div>
          <div style="display: flex; flex: 1; overflow: hidden;">
            <div class="explorer-content" id="explorerContent" style="flex: 1;">
              <!-- Content will be generated by JavaScript -->
            </div>
            <div class="preview-pane" id="previewPane" style="display: none; width: 300px; background: #252525; border-left: 1px solid #3a3a3a; padding: 15px; overflow-y: auto;">
              <div style="color: #888; font-size: 12px; margin-bottom: 10px;">Preview</div>
              <div id="previewContent" style="color: white; font-size: 13px;">Select a file to preview</div>
            </div>
          </div>
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'explorerWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'explorerWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'explorerWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'explorerWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'explorerWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'explorerWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'explorerWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'explorerWindow', 'se')"></div>
    </div>

    <div class="window" id="notepadWindow" style="top: 80px; left: 150px; width: 600px; height: 400px;">
      <div class="window-header" onmousedown="startDrag(event, 'notepadWindow')" ondblclick="maximizeWindow('notepad')">
        <div class="window-title"><span>üìù</span> Notepad</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('notepad')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('notepad')" title="Maximize" onmouseenter="showSnapLayouts(event, 'notepad')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('notepad')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 0;">
        <textarea id="notepadText" style="width: 100%; height: 100%; background: #1e1e1e; color: white; border: none; resize: none; padding: 15px; font-family: Consolas, monospace; font-size: 14px;" placeholder="◊î◊™◊ó◊ú ◊ú◊õ◊™◊ï◊ë..."></textarea>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'notepadWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'notepadWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'notepadWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'notepadWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'notepadWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'notepadWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'notepadWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'notepadWindow', 'se')"></div>
    </div>

    <div class="window" id="settingsWindow" style="top: 60px; left: 200px; width: 850px; height: 500px;">
      <div class="window-header" onmousedown="startDrag(event, 'settingsWindow')" ondblclick="maximizeWindow('settings')">
        <div class="window-title"><span>‚öôÔ∏è</span> Settings</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('settings')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('settings')" title="Maximize" onmouseenter="showSnapLayouts(event, 'settings')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('settings')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body explorer-body">
        <div class="sidebar" style="width: 220px;">
          <div class="sidebar-item active" onclick="showSettingsPage('home')">üè† Home</div>
          <div class="sidebar-item" onclick="showSettingsPage('system')">üñ•Ô∏è System</div>
          <div class="sidebar-item" onclick="showSettingsPage('bluetooth')">üì± Bluetooth</div>
          <div class="sidebar-item" onclick="showSettingsPage('network')">üì∂ Network</div>
          <div class="sidebar-item" onclick="showSettingsPage('personalization')">üé® Personalization</div>
          <div class="sidebar-item" onclick="showSettingsPage('apps')">üì¶ Apps</div>
          <div class="sidebar-item" onclick="showSettingsPage('privacy')">üîí Privacy</div>
          <div class="sidebar-item" onclick="showSettingsPage('update')">üîÑ Update</div>
        </div>
        <div class="explorer-content" id="settingsContent" style="flex-direction: column; display: flex; gap: 15px; align-content: unset;">
          <h2 style="font-size: 24px; margin: 0;">Settings</h2>
          <div style="background: #2d2d2d; padding: 15px; border-radius: 8px;">
            <div style="font-size: 14px;">Windows 11 Pro</div>
            <div style="font-size: 12px; color: #888;">Version 23H2</div>
          </div>
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'settingsWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'settingsWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'settingsWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'settingsWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'settingsWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'settingsWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'settingsWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'settingsWindow', 'se')"></div>
    </div>

    <div class="window" id="edgeWindow" style="top: 40px; left: 120px; width: 900px; height: 550px;">
      <div class="window-header" onmousedown="startDrag(event, 'edgeWindow')" ondblclick="maximizeWindow('edge')">
        <div class="window-title"><span>üåê</span> Microsoft Edge</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('edge')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('edge')" title="Maximize" onmouseenter="showSnapLayouts(event, 'edge')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('edge')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 0; display: flex; flex-direction: column;">
        <div class="browser-toolbar" style="background: #2d2d2d; padding: 8px 12px; display: flex; gap: 8px; align-items: center;">
          <div class="nav-btn" onclick="browserBack()" title="Back">‚Üê</div>
          <div class="nav-btn" onclick="browserForward()" title="Forward">‚Üí</div>
          <div class="nav-btn" onclick="browserRefresh()" title="Refresh">üîÑ</div>
          <div class="nav-btn" onclick="browserHome()" title="Home">üè†</div>
          <input type="text" id="browserUrl" value="https://www.google.com/webhp?igu=1" 
            style="flex: 1; padding: 8px 12px; border-radius: 20px; border: none; background: #1e1e1e; color: white; font-size: 13px;"
            onkeypress="if(event.key==='Enter') browserNavigate()">
          <div class="nav-btn" onclick="browserNavigate()" title="Go">‚ûú</div>
        </div>
        <div class="browser-tabs" style="background: #252525; padding: 4px 8px; display: flex; gap: 2px; align-items: center;">
          <div class="browser-tab active" style="background: #1e1e1e; padding: 6px 12px; border-radius: 8px 8px 0 0; font-size: 12px; color: #fff; display: flex; align-items: center; gap: 6px; max-width: 200px;">
            <span id="tabIcon">üåê</span>
            <span id="tabTitle" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">New Tab</span>
          </div>
          <div style="padding: 4px 10px; color: #888; cursor: pointer; font-size: 16px;">+</div>
        </div>
        <div class="browser-content" style="flex: 1; position: relative; background: #fff;">
          <iframe id="browserFrame" 
            src="https://www.google.com/webhp?igu=1" 
            style="width: 100%; height: 100%; border: none;"
            sandbox="allow-same-origin allow-scripts allow-popups allow-forms"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
          </iframe>
          <div id="browserLoading" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #333;">
            <div style="font-size: 32px; animation: spin 1s linear infinite;">‚è≥</div>
          </div>
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'edgeWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'edgeWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'edgeWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'edgeWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'edgeWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'edgeWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'edgeWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'edgeWindow', 'se')"></div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
      <div class="context-item" onclick="document.getElementById('desktopContainer').style.background = 'url(https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920) center/cover'">üëÅÔ∏è View</div>
      <div class="context-item">üìã Sort by</div>
      <div class="context-item" onclick="location.reload()">üîÑ Refresh</div>
      <div class="context-divider"></div>
      <div class="context-item" onclick="clipboardCut()" id="contextCut" style="display: none;">‚úÇÔ∏è Cut</div>
      <div class="context-item" onclick="clipboardCopy()" id="contextCopy" style="display: none;">üìã Copy</div>
      <div class="context-item" onclick="clipboardPaste()" id="contextPaste" style="display: none;">üìÑ Paste</div>
      <div class="context-item" onclick="renameSelectedFile()" id="contextRename" style="display: none;">‚úèÔ∏è Rename</div>
      <div class="context-item" onclick="deleteSelectedFile()" id="contextDelete" style="display: none;">üóëÔ∏è Delete</div>
      <div class="context-item" onclick="showProperties()" id="contextProperties" style="display: none;">‚ÑπÔ∏è Properties</div>
      <div class="context-divider"></div>
      <div class="context-item" onclick="createNewFolder()">üìÅ New folder</div>
      <div class="context-item" onclick="createNewFile()">üìÑ New file</div>
      <div class="context-divider"></div>
      <div class="context-item" onclick="openWindow('settings')">üñºÔ∏è Personalize</div>
      <div class="context-item" onclick="openWindow('settings')">‚öôÔ∏è Display settings</div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Snap Layouts -->
    <div class="snap-layouts" id="snapLayouts">
      <div class="snap-zone" onclick="snapWindow('top-left')"></div>
      <div class="snap-zone" onclick="snapWindow('top-right')"></div>
      <div class="snap-zone" onclick="snapWindow('bottom-left')"></div>
      <div class="snap-zone" onclick="snapWindow('bottom-right')"></div>
    </div>

    <!-- Task View -->
    <div class="task-view" id="taskView">
      <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;">
        <div class="desktop-thumbnail active" onclick="switchDesktop(0)">
          <div style="padding: 20px; color: white; font-size: 14px;">Desktop 1</div>
        </div>
        <div class="desktop-thumbnail" onclick="switchDesktop(1)">
          <div style="padding: 20px; color: white; font-size: 14px;">Desktop 2</div>
        </div>
      </div>
    </div>

    <!-- Properties Dialog -->
    <div class="properties-dialog" id="propertiesDialog">
      <div class="properties-header">
        <span id="propertiesIcon">üìÑ</span>
        <span id="propertiesName">File Properties</span>
      </div>
      <div id="propertiesContent"></div>
      <div style="display: flex; justify-content: flex-end; margin-top: 20px; gap: 10px;">
        <button onclick="document.getElementById('propertiesDialog').classList.remove('show')" style="padding: 8px 16px; background: #0078d4; border: none; border-radius: 4px; color: white; cursor: pointer;">OK</button>
      </div>
    </div>

    <!-- Photos App -->
    <div class="window" id="photosWindow" style="top: 60px; left: 200px; width: 900px; height: 600px;">
      <div class="window-header" onmousedown="startDrag(event, 'photosWindow')" ondblclick="maximizeWindow('photos')">
        <div class="window-title"><span>üñºÔ∏è</span> Photos</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('photos')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('photos')" title="Maximize" onmouseenter="showSnapLayouts(event, 'photos')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('photos')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 0;">
        <div class="photos-grid" id="photosGrid"></div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'photosWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'photosWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'photosWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'photosWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'photosWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'photosWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'photosWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'photosWindow', 'se')"></div>
    </div>

    <!-- Photo Viewer -->
    <div class="photo-viewer" id="photoViewer">
      <div class="photo-nav prev" onclick="prevPhoto()">‚óÄ</div>
      <img id="photoViewerImg" src="" alt="">
      <div class="photo-nav next" onclick="nextPhoto()">‚ñ∂</div>
      <div style="position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: white;" onclick="closePhotoViewer()">‚úï</div>
    </div>

    <!-- Media Player -->
    <div class="window" id="mediaplayerWindow" style="top: 70px; left: 250px; width: 700px; height: 500px;">
      <div class="window-header" onmousedown="startDrag(event, 'mediaplayerWindow')" ondblclick="maximizeWindow('mediaplayer')">
        <div class="window-title"><span>üéµ</span> Media Player</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('mediaplayer')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('mediaplayer')" title="Maximize" onmouseenter="showSnapLayouts(event, 'mediaplayer')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('mediaplayer')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 0; display: flex; flex-direction: column;">
        <video id="mediaPlayerVideo" style="flex: 1; background: #000;" controls></video>
        <audio id="mediaPlayerAudio" style="display: none;" controls></audio>
        <div class="media-player-controls">
          <div class="media-progress" onclick="seekMedia(event)">
            <div class="media-progress-bar" id="mediaProgressBar"></div>
          </div>
          <div class="media-buttons">
            <button class="media-btn" onclick="prevTrack()">‚èÆ</button>
            <button class="media-btn play" onclick="togglePlayPause()" id="playPauseBtn">‚ñ∂</button>
            <button class="media-btn" onclick="nextTrack()">‚è≠</button>
            <div style="margin-left: 20px; display: flex; align-items: center; gap: 10px;">
              <span>üîä</span>
              <input type="range" min="0" max="100" value="50" id="mediaVolume" oninput="setMediaVolume(this.value)" style="width: 100px;">
            </div>
          </div>
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'mediaplayerWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'mediaplayerWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'mediaplayerWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'mediaplayerWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'mediaplayerWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'mediaplayerWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'mediaplayerWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'mediaplayerWindow', 'se')"></div>
    </div>

    <!-- Snipping Tool -->
    <div class="snipping-overlay" id="snippingOverlay"></div>
    <div class="snipping-selection" id="snippingSelection"></div>
    <div class="snipping-preview" id="snippingPreview">
      <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
        <h3 style="margin: 0; color: white;">Screenshot</h3>
        <span onclick="closeSnippingPreview()" style="cursor: pointer; color: white; font-size: 20px;">‚úï</span>
      </div>
      <img id="snippingPreviewImg" src="" alt="">
      <div style="display: flex; gap: 10px; margin-top: 15px;">
        <button onclick="copyScreenshot()" style="padding: 8px 16px; background: #0078d4; border: none; border-radius: 4px; color: white; cursor: pointer;">Copy</button>
        <button onclick="saveScreenshot()" style="padding: 8px 16px; background: #2d2d2d; border: none; border-radius: 4px; color: white; cursor: pointer;">Save</button>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
    </div>

    <!-- Screensaver -->
    <div class="screensaver" id="screensaver">
      <div class="screensaver-content">Windows 11</div>
    </div>

    <!-- Calendar Popup -->
    <div class="calendar-popup" id="calendarPopup">
      <div class="calendar-header">
        <div class="calendar-nav" onclick="changeMonth(-1)">‚óÄ</div>
        <div id="calendarMonth">December 2024</div>
        <div class="calendar-nav" onclick="changeMonth(1)">‚ñ∂</div>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <!-- Quick Settings -->
    <div class="quick-settings" id="quickSettings">
      <div class="qs-grid">
        <div class="qs-btn active" onclick="this.classList.toggle('active')"><span>üì∂</span><small>Wi-Fi</small></div>
        <div class="qs-btn" onclick="this.classList.toggle('active')"><span>üì±</span><small>Bluetooth</small></div>
        <div class="qs-btn" onclick="this.classList.toggle('active')"><span>‚úàÔ∏è</span><small>Airplane</small></div>
        <div class="qs-btn" onclick="this.classList.toggle('active')"><span>üîã</span><small>Battery</small></div>
        <div class="qs-btn active" onclick="this.classList.toggle('active')"><span>üåô</span><small>Night</small></div>
        <div class="qs-btn" onclick="this.classList.toggle('active')"><span>üîí</span><small>VPN</small></div>
      </div>
      <div class="qs-slider">
        <label>üîÜ <input type="range" min="0" max="100" value="80" id="brightnessSlider"> <span id="brightnessVal">80%</span></label>
      </div>
      <div class="qs-slider">
        <label>üîä <input type="range" min="0" max="100" value="50" id="volumeSlider" oninput="updateVolume(this.value)"> <span id="volumeVal">50%</span></label>
      </div>
    </div>

    <!-- Widgets Panel -->
    <div class="widgets-panel" id="widgetsPanel">
      <div class="widget-card">
        <div class="widget-title">üå§Ô∏è Weather</div>
        <div class="weather-main">
          <div class="weather-icon">‚òÄÔ∏è</div>
          <div class="weather-temp">22¬∞</div>
          <div style="color: #aaa;">Tel Aviv<br>Sunny</div>
        </div>
        <div class="weather-details">
          <div>üíß 45%<br>Humidity</div>
          <div>üí® 12 km/h<br>Wind</div>
          <div>üå°Ô∏è 18¬∞-25¬∞<br>Hi/Lo</div>
        </div>
      </div>
      <div class="widget-card">
        <div class="widget-title">üì∞ News</div>
        <div style="font-size: 13px; line-height: 1.6;">
          <div style="padding: 10px 0; border-bottom: 1px solid #444;">Tech Giants Report Record Earnings</div>
          <div style="padding: 10px 0; border-bottom: 1px solid #444;">New AI Breakthrough Announced</div>
          <div style="padding: 10px 0;">Space Mission Successfully Launches</div>
        </div>
      </div>
      <div class="widget-card">
        <div class="widget-title">üìà Stocks</div>
        <div style="font-size: 13px;">
          <div style="display: flex; justify-content: space-between; padding: 8px 0;"><span>MSFT</span><span style="color: #4caf50;">‚ñ≤ 2.3%</span></div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0;"><span>AAPL</span><span style="color: #4caf50;">‚ñ≤ 1.1%</span></div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0;"><span>GOOGL</span><span style="color: #f44336;">‚ñº 0.5%</span></div>
        </div>
      </div>
    </div>

    <!-- Calculator Window -->
    <div class="window" id="calculatorWindow" style="top: 100px; left: 300px; width: 320px; height: 450px;">
      <div class="window-header" onmousedown="startDrag(event, 'calculatorWindow')" ondblclick="maximizeWindow('calculator')">
        <div class="window-title"><span>üßÆ</span> Calculator</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('calculator')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('calculator')" title="Maximize" onmouseenter="showSnapLayouts(event, 'calculator')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('calculator')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 15px;">
        <div class="calc-display" id="calcDisplay">0</div>
        <div class="calc-grid">
          <div class="calc-btn op" onclick="clearCalc()">C</div>
          <div class="calc-btn op" onclick="calcInput('¬±')">¬±</div>
          <div class="calc-btn op" onclick="calcInput('%')">%</div>
          <div class="calc-btn op" onclick="calcInput('/')">√∑</div>
          <div class="calc-btn num" onclick="calcInput('7')">7</div>
          <div class="calc-btn num" onclick="calcInput('8')">8</div>
          <div class="calc-btn num" onclick="calcInput('9')">9</div>
          <div class="calc-btn op" onclick="calcInput('*')">√ó</div>
          <div class="calc-btn num" onclick="calcInput('4')">4</div>
          <div class="calc-btn num" onclick="calcInput('5')">5</div>
          <div class="calc-btn num" onclick="calcInput('6')">6</div>
          <div class="calc-btn op" onclick="calcInput('-')">‚àí</div>
          <div class="calc-btn num" onclick="calcInput('1')">1</div>
          <div class="calc-btn num" onclick="calcInput('2')">2</div>
          <div class="calc-btn num" onclick="calcInput('3')">3</div>
          <div class="calc-btn op" onclick="calcInput('+')">+</div>
          <div class="calc-btn num" onclick="calcInput('0')" style="grid-column: span 2;">0</div>
          <div class="calc-btn num" onclick="calcInput('.')">.</div>
          <div class="calc-btn eq" onclick="calcResult()">=</div>
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'calculatorWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'calculatorWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'calculatorWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'calculatorWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'calculatorWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'calculatorWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'calculatorWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'calculatorWindow', 'se')"></div>
    </div>

    <!-- Terminal Window -->
    <div class="window" id="terminalWindow" style="top: 80px; left: 200px; width: 700px; height: 400px;">
      <div class="window-header" onmousedown="startDrag(event, 'terminalWindow')" ondblclick="maximizeWindow('terminal')">
        <div class="window-title"><span>‚¨õ</span> Windows Terminal</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('terminal')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('terminal')" title="Maximize" onmouseenter="showSnapLayouts(event, 'terminal')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('terminal')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="background: #0c0c0c; padding: 15px; font-family: Consolas, monospace;">
        <div class="terminal-output" id="terminalOutput">Microsoft Windows [Version 10.0.22631.2861]
(c) Microsoft Corporation. All rights reserved.

</div>
        <div class="terminal-input">
          <span class="terminal-prompt">C:\Users\Shalom></span>
          <input type="text" id="terminalInput" onkeypress="if(event.key==='Enter') executeCommand()">
        </div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'terminalWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'terminalWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'terminalWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'terminalWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'terminalWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'terminalWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'terminalWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'terminalWindow', 'se')"></div>
    </div>

    <!-- Task Manager Window -->
    <div class="window" id="taskmanagerWindow" style="top: 70px; left: 180px; width: 600px; height: 450px;">
      <div class="window-header" onmousedown="startDrag(event, 'taskmanagerWindow')" ondblclick="maximizeWindow('taskmanager')">
        <div class="window-title"><span>üìä</span> Task Manager</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('taskmanager')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('taskmanager')" title="Maximize" onmouseenter="showSnapLayouts(event, 'taskmanager')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('taskmanager')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 15px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; text-align: center; flex: 1; margin-right: 10px;">
            <div style="font-size: 24px; color: #0078d4;" id="cpuUsage">23%</div>
            <div style="font-size: 12px; color: #888;">CPU</div>
          </div>
          <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; text-align: center; flex: 1; margin-right: 10px;">
            <div style="font-size: 24px; color: #9c27b0;" id="memUsage">67%</div>
            <div style="font-size: 12px; color: #888;">Memory</div>
          </div>
          <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; text-align: center; flex: 1;">
            <div style="font-size: 24px; color: #4caf50;" id="diskUsage">12%</div>
            <div style="font-size: 12px; color: #888;">Disk</div>
          </div>
        </div>
        <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px;">Processes</div>
        <div class="task-list" id="taskList"></div>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'taskmanagerWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'taskmanagerWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'taskmanagerWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'taskmanagerWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'taskmanagerWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'taskmanagerWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'taskmanagerWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'taskmanagerWindow', 'se')"></div>
    </div>

    <!-- Paint Window -->
    <div class="window" id="paintWindow" style="top: 50px; left: 150px; width: 800px; height: 550px;">
      <div class="window-header" onmousedown="startDrag(event, 'paintWindow')" ondblclick="maximizeWindow('paint')">
        <div class="window-title"><span>üé®</span> Paint</div>
        <div class="window-controls">
          <div class="win-btn" onclick="minimizeWindow('paint')" title="Minimize">‚îÄ</div>
          <div class="win-btn" onclick="maximizeWindow('paint')" title="Maximize" onmouseenter="showSnapLayouts(event, 'paint')" onmouseleave="hideSnapLayouts()">‚òê</div>
          <div class="win-btn close" onclick="closeWindow('paint')" title="Close">‚úï</div>
        </div>
      </div>
      <div class="window-body" style="padding: 0; display: flex; flex-direction: column;">
        <div class="paint-toolbar">
          <div class="paint-colors">
            <div class="paint-color active" style="background: #000" onclick="setPaintColor('#000', this)"></div>
            <div class="paint-color" style="background: #fff" onclick="setPaintColor('#fff', this)"></div>
            <div class="paint-color" style="background: #0078d4" onclick="setPaintColor('#0078d4', this)"></div>
            <div class="paint-color" style="background: #4caf50" onclick="setPaintColor('#4caf50', this)"></div>
            <div class="paint-color" style="background: #ff9800" onclick="setPaintColor('#ff9800', this)"></div>
            <div class="paint-color" style="background: #9c27b0" onclick="setPaintColor('#9c27b0', this)"></div>
            <div class="paint-color" style="background: #ffeb3b" onclick="setPaintColor('#ffeb3b', this)"></div>
          </div>
          <div class="paint-sizes">
            <div class="paint-size active" onclick="setPaintSize(2, this)">S</div>
            <div class="paint-size" onclick="setPaintSize(5, this)">M</div>
            <div class="paint-size" onclick="setPaintSize(10, this)">L</div>
          </div>
          <div class="nav-btn" onclick="clearCanvas()" style="margin-left: auto;">üóëÔ∏è</div>
        </div>
        <canvas id="paintCanvas" class="paint-canvas" style="flex: 1;"></canvas>
      </div>
      <div class="resize-handle nw" onmousedown="startResize(event, 'paintWindow', 'nw')"></div>
      <div class="resize-handle n" onmousedown="startResize(event, 'paintWindow', 'n')"></div>
      <div class="resize-handle ne" onmousedown="startResize(event, 'paintWindow', 'ne')"></div>
      <div class="resize-handle w" onmousedown="startResize(event, 'paintWindow', 'w')"></div>
      <div class="resize-handle e" onmousedown="startResize(event, 'paintWindow', 'e')"></div>
      <div class="resize-handle sw" onmousedown="startResize(event, 'paintWindow', 'sw')"></div>
      <div class="resize-handle s" onmousedown="startResize(event, 'paintWindow', 's')"></div>
      <div class="resize-handle se" onmousedown="startResize(event, 'paintWindow', 'se')"></div>
    </div>

    <!-- Alt+Tab Switcher -->
    <div class="alt-tab-switcher" id="altTabSwitcher"></div>

    <!-- BSOD Screen -->
    <div class="bsod-screen" id="bsodScreen">
      <div class="bsod-sad">:(</div>
      <div class="bsod-title">Your PC ran into a problem and needs to restart.</div>
      <div class="bsod-text">We're just collecting some error info, and then we'll restart for you.<br><br>0% complete</div>
      <div class="bsod-qr">‚ñ£</div>
      <div class="bsod-text" style="margin-top: 20px;">For more information about this issue and possible fixes, visit<br>https://www.windows.com/stopcode</div>
      <div class="bsod-text" style="margin-top: 15px;">Stop code: CRITICAL_PROCESS_DIED</div>
    </div>

    <!-- Lock Overlay -->
    <div class="lock-overlay" id="lockOverlay">
      <div class="lock-time" style="position: relative; bottom: auto; left: auto; text-align: center;">
        <div class="time" id="lockOverlayTime">12:00</div>
        <div class="date" id="lockOverlayDate">◊ô◊ï◊ù ◊ó◊û◊ô◊©◊ô, 18 ◊ë◊ì◊¶◊û◊ë◊®</div>
      </div>
      <div class="lock-hint" style="margin-top: 50px;">◊ú◊ó◊• ◊ê◊ï ◊î◊ß◊© ◊ú◊î◊û◊©◊ö</div>
    </div>
  </div>

  <script>
    // BIOS Content
    const biosLines = [
      'American Megatrends AMIBIOS(C) 2024',
      '',
      'BIOS Date: 11/15/24  Ver: 2.85.1247',
      'CPU: Intel(R) Core(TM) i7-13700K @ 5.40GHz',
      'Speed: 5400 MHz    Count: 16',
      '',
      'Press DEL to run Setup',
      'Press F12 for Boot Menu',
      '',
      'Initializing USB Controllers ... Done',
      'USB Device(s): 3 Keyboard, 1 Mouse, 2 Storage',
      '',
      'Auto-Detecting SATA1... Samsung SSD 990 PRO 2TB',
      'Auto-Detecting SATA2... WD Black 4TB',
      'Auto-Detecting SATA3... None',
      '',
      'Memory Test: 32768MB OK',
      '',
      'Checking NVRAM...',
      'Initializing Intel(R) Boot Agent...',
      '',
      '>>> Loading Operating System...',
    ];

    let biosIndex = 0;
    const biosContent = document.getElementById('biosContent');

    function typeBios() {
      if (biosIndex < biosLines.length) {
        const line = document.createElement('div');
        line.className = 'bios-line';
        line.textContent = biosLines[biosIndex] || '\u00A0';
        line.style.animationDelay = '0s';
        biosContent.appendChild(line);
        biosIndex++;
        setTimeout(typeBios, 80);
      } else {
        setTimeout(() => {
          document.getElementById('biosScreen').style.display = 'none';
          document.getElementById('bootScreen').style.display = 'flex';
          setTimeout(showWindowsLoading, 2500);
        }, 800);
      }
    }

    function showWindowsLoading() {
      document.getElementById('bootScreen').style.display = 'none';
      document.getElementById('loadingScreen').style.display = 'flex';
      
      const texts = ['Getting things ready', 'Just a moment...', 'Getting Windows ready', 'Almost there...'];
      let ti = 0;
      const textInterval = setInterval(() => {
        ti = (ti + 1) % texts.length;
        document.getElementById('loadingText').textContent = texts[ti];
      }, 2000);

      setTimeout(() => {
        clearInterval(textInterval);
        document.getElementById('loadingScreen').style.display = 'none';
        document.getElementById('lockScreen').style.display = 'flex';
        updateLockTime();
      }, 5000);
    }

    function updateLockTime() {
      const now = new Date();
      document.getElementById('lockTime').textContent = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
      const options = { weekday: 'long', day: 'numeric', month: 'long' };
      document.getElementById('lockDate').textContent = now.toLocaleDateString('he-IL', options);
    }

    document.getElementById('lockScreen').onclick = () => {
      document.getElementById('lockScreen').style.display = 'none';
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('passwordInput').focus();
    };

    document.getElementById('passwordInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') login();
    });

    function login() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('welcomeScreen').style.display = 'flex';
      
      setTimeout(() => {
        document.getElementById('welcomeScreen').style.display = 'none';
        document.getElementById('desktopContainer').style.display = 'block';
        updateClock();
      }, 2500);
    }

    function shutdown() {
      document.getElementById('startMenu').classList.remove('open');
      document.getElementById('desktopContainer').style.display = 'none';
      document.getElementById('shutdownScreen').style.display = 'flex';
      
      setTimeout(() => {
        document.getElementById('shutdownText').textContent = 'Shutting down...';
      }, 1500);
      
      setTimeout(() => {
        document.getElementById('shutdownScreen').style.display = 'none';
        // Restart
        biosIndex = 0;
        biosContent.innerHTML = '';
        document.getElementById('biosScreen').style.display = 'block';
        typeBios();
      }, 4000);
    }

    // Clock
    function updateClock() {
      const now = new Date();
      document.getElementById('time').textContent = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
      document.getElementById('date').textContent = now.toLocaleDateString('he-IL');
    }
    setInterval(updateClock, 1000);

    // Start Menu
    function toggleStartMenu() {
      document.getElementById('startMenu').classList.toggle('open');
    }

    // Windows
    function openWindow(name) {
      document.getElementById('startMenu').classList.remove('open');
      const win = document.getElementById(name + 'Window');
      if (win) { win.classList.add('open'); bringToFront(win); }
    }

    function closeWindow(name) {
      const win = document.getElementById(name + 'Window');
      if (win) win.classList.remove('open');
    }

    // Dragging
    let draggedWindow = null, offsetX, offsetY;

    function startDrag(e, winId) {
      draggedWindow = document.getElementById(winId);
      bringToFront(draggedWindow);
      offsetX = e.clientX - draggedWindow.offsetLeft;
      offsetY = e.clientY - draggedWindow.offsetTop;
    }

    document.addEventListener('mousemove', (e) => {
      if (draggedWindow) {
        draggedWindow.style.left = (e.clientX - offsetX) + 'px';
        draggedWindow.style.top = (e.clientY - offsetY) + 'px';
      }
    });

    document.addEventListener('mouseup', () => { draggedWindow = null; });

    let zIndex = 50;
    function bringToFront(win) { zIndex++; win.style.zIndex = zIndex; }

    document.querySelectorAll('.window').forEach(win => {
      win.addEventListener('mousedown', () => bringToFront(win));
    });

    // Context Menu
    document.addEventListener('contextmenu', (e) => {
      if (!e.target.closest('.window') && !e.target.closest('.taskbar') && !e.target.closest('.start-menu')) {
        e.preventDefault();
        const menu = document.getElementById('contextMenu');
        menu.classList.add('open');
        menu.style.left = e.clientX + 'px';
        menu.style.top = e.clientY + 'px';
      }
    });

    document.addEventListener('click', (e) => {
      document.getElementById('contextMenu').classList.remove('open');
      if (!e.target.closest('.start-menu') && !e.target.closest('.start-btn')) {
        document.getElementById('startMenu').classList.remove('open');
      }
    });

    // ====== FILE SYSTEM ======
    const fileSystem = {
      'This PC': {
        type: 'folder',
        icon: 'üíª',
        children: {
          'Desktop': { type: 'folder', icon: 'üìÅ' },
          'Documents': { type: 'folder', icon: 'üìÑ' },
          'Downloads': { type: 'folder', icon: '‚¨áÔ∏è' },
          'Music': { type: 'folder', icon: 'üéµ' },
          'Pictures': { type: 'folder', icon: 'üñºÔ∏è' },
          'Videos': { type: 'folder', icon: 'üé¨' },
          'Local Disk (C:)': { type: 'drive', icon: 'üíø' },
          'Local Disk (D:)': { type: 'drive', icon: 'üíø' }
        }
      },
      'Desktop': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Projects': { type: 'folder', icon: 'üìÅ' },
          'Work': { type: 'folder', icon: 'üìÅ' },
          'notes.txt': { type: 'file', icon: 'üìÑ' },
          'image.png': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Desktop/Projects': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Website': { type: 'folder', icon: 'üìÅ' },
          'App': { type: 'folder', icon: 'üìÅ' },
          'README.md': { type: 'file', icon: 'üìÑ' },
          'config.json': { type: 'file', icon: '‚öôÔ∏è' }
        }
      },
      'Desktop/Projects/Website': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'src': { type: 'folder', icon: 'üìÅ' },
          'public': { type: 'folder', icon: 'üìÅ' },
          'index.html': { type: 'file', icon: 'üåê' },
          'style.css': { type: 'file', icon: 'üé®' },
          'script.js': { type: 'file', icon: 'üìú' }
        }
      },
      'Desktop/Projects/Website/src': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'components': { type: 'folder', icon: 'üìÅ' },
          'App.js': { type: 'file', icon: 'üìú' },
          'main.js': { type: 'file', icon: 'üìú' }
        }
      },
      'Desktop/Projects/Website/src/components': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Header.js': { type: 'file', icon: 'üìú' },
          'Footer.js': { type: 'file', icon: 'üìú' },
          'Button.js': { type: 'file', icon: 'üìú' }
        }
      },
      'Desktop/Projects/Website/public': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'images': { type: 'folder', icon: 'üìÅ' },
          'favicon.ico': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Desktop/Projects/Website/public/images': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'logo.png': { type: 'file', icon: 'üñºÔ∏è' },
          'banner.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'icons': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Desktop/Projects/Website/public/images/icons': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'home.svg': { type: 'file', icon: 'üñºÔ∏è' },
          'settings.svg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Desktop/Projects/App': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'android': { type: 'folder', icon: 'üìÅ' },
          'ios': { type: 'folder', icon: 'üìÅ' },
          'package.json': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Projects/App/android': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'app': { type: 'folder', icon: 'üìÅ' },
          'build.gradle': { type: 'file', icon: '‚öôÔ∏è' }
        }
      },
      'Desktop/Projects/App/android/app': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'src': { type: 'folder', icon: 'üìÅ' },
          'MainActivity.java': { type: 'file', icon: '‚òï' }
        }
      },
      'Desktop/Projects/App/android/app/src': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'main': { type: 'folder', icon: 'üìÅ' },
          'test': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Desktop/Projects/App/android/app/src/main': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'res': { type: 'folder', icon: 'üìÅ' },
          'AndroidManifest.xml': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Projects/App/android/app/src/main/res': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'drawable': { type: 'folder', icon: 'üìÅ' },
          'layout': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Desktop/Projects/App/android/app/src/main/res/drawable': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'icon.png': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Desktop/Projects/App/android/app/src/main/res/layout': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'activity_main.xml': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Projects/App/android/app/src/test': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'MainTest.java': { type: 'file', icon: '‚òï' }
        }
      },
      'Desktop/Projects/App/ios': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Runner': { type: 'folder', icon: 'üìÅ' },
          'Podfile': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Projects/App/ios/Runner': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Assets.xcassets': { type: 'folder', icon: 'üìÅ' },
          'AppDelegate.swift': { type: 'file', icon: 'üìú' }
        }
      },
      'Desktop/Projects/App/ios/Runner/Assets.xcassets': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'AppIcon.appiconset': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Desktop/Projects/App/ios/Runner/Assets.xcassets/AppIcon.appiconset': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'icon-20.png': { type: 'file', icon: 'üñºÔ∏è' },
          'icon-40.png': { type: 'file', icon: 'üñºÔ∏è' },
          'Contents.json': { type: 'file', icon: '‚öôÔ∏è' }
        }
      },
      'Desktop/Work': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Reports': { type: 'folder', icon: 'üìÅ' },
          'Meetings': { type: 'folder', icon: 'üìÅ' },
          'presentation.pptx': { type: 'file', icon: 'üìä' },
          'budget.xlsx': { type: 'file', icon: 'üìà' }
        }
      },
      'Desktop/Work/Reports': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Q1': { type: 'folder', icon: 'üìÅ' },
          'Q2': { type: 'folder', icon: 'üìÅ' },
          'Annual Report.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Work/Reports/Q1': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'January.xlsx': { type: 'file', icon: 'üìà' },
          'February.xlsx': { type: 'file', icon: 'üìà' },
          'March.xlsx': { type: 'file', icon: 'üìà' }
        }
      },
      'Desktop/Work/Reports/Q2': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'April.xlsx': { type: 'file', icon: 'üìà' },
          'May.xlsx': { type: 'file', icon: 'üìà' },
          'June.xlsx': { type: 'file', icon: 'üìà' }
        }
      },
      'Desktop/Work/Meetings': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Team Meetings': { type: 'folder', icon: 'üìÅ' },
          'Client Meetings': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Desktop/Work/Meetings/Team Meetings': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'weekly-sync.docx': { type: 'file', icon: 'üìÑ' },
          'retrospective.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Desktop/Work/Meetings/Client Meetings': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'client-a-notes.docx': { type: 'file', icon: 'üìÑ' },
          'client-b-notes.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Documents': {
        type: 'folder',
        icon: 'üìÑ',
        children: {
          'Personal': { type: 'folder', icon: 'üìÅ' },
          'Templates': { type: 'folder', icon: 'üìÅ' },
          'resume.docx': { type: 'file', icon: 'üìÑ' },
          'notes.txt': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Documents/Personal': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Letters': { type: 'folder', icon: 'üìÅ' },
          'diary.txt': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Documents/Personal/Letters': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'letter-2024.docx': { type: 'file', icon: 'üìÑ' },
          'letter-2023.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Documents/Templates': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'invoice-template.xlsx': { type: 'file', icon: 'üìà' },
          'report-template.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Downloads': {
        type: 'folder',
        icon: '‚¨áÔ∏è',
        children: {
          'software-installer.exe': { type: 'file', icon: 'üíø' },
          'document.pdf': { type: 'file', icon: 'üìï' },
          'photo.zip': { type: 'file', icon: 'üì¶' }
        }
      },
      'Music': {
        type: 'folder',
        icon: 'üéµ',
        children: {
          'Playlists': { type: 'folder', icon: 'üìÅ' },
          'favorite-song.mp3': { type: 'file', icon: 'üéµ' },
          'album.zip': { type: 'file', icon: 'üì¶' }
        }
      },
      'Music/Playlists': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Rock': { type: 'folder', icon: 'üìÅ' },
          'Jazz': { type: 'folder', icon: 'üìÅ' },
          'workout.m3u': { type: 'file', icon: 'üéµ' }
        }
      },
      'Music/Playlists/Rock': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'song1.mp3': { type: 'file', icon: 'üéµ' },
          'song2.mp3': { type: 'file', icon: 'üéµ' }
        }
      },
      'Music/Playlists/Jazz': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'smooth-jazz.mp3': { type: 'file', icon: 'üéµ' },
          'classic.mp3': { type: 'file', icon: 'üéµ' }
        }
      },
      'Pictures': {
        type: 'folder',
        icon: 'üñºÔ∏è',
        children: {
          'Screenshots': { type: 'folder', icon: 'üìÅ' },
          'Wallpapers': { type: 'folder', icon: 'üìÅ' },
          'Photos': { type: 'folder', icon: 'üìÅ' },
          'vacation.jpg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Screenshots': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'screenshot-1.png': { type: 'file', icon: 'üñºÔ∏è' },
          'screenshot-2.png': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Wallpapers': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'nature': { type: 'folder', icon: 'üìÅ' },
          'abstract': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Pictures/Wallpapers/nature': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'mountain.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'ocean.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'forest.jpg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Wallpapers/abstract': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'gradient-1.png': { type: 'file', icon: 'üñºÔ∏è' },
          'gradient-2.png': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Photos': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          '2024': { type: 'folder', icon: 'üìÅ' },
          '2023': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Pictures/Photos/2024': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'January': { type: 'folder', icon: 'üìÅ' },
          'February': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Pictures/Photos/2024/January': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'IMG_001.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'IMG_002.jpg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Photos/2024/February': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'IMG_010.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'IMG_011.jpg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Pictures/Photos/2023': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'December': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Pictures/Photos/2023/December': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'holiday-1.jpg': { type: 'file', icon: 'üñºÔ∏è' },
          'holiday-2.jpg': { type: 'file', icon: 'üñºÔ∏è' }
        }
      },
      'Videos': {
        type: 'folder',
        icon: 'üé¨',
        children: {
          'Movies': { type: 'folder', icon: 'üìÅ' },
          'Recordings': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Videos/Movies': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'movie-2024.mp4': { type: 'file', icon: 'üé¨' }
        }
      },
      'Videos/Recordings': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'meeting-recording.mp4': { type: 'file', icon: 'üé¨' },
          'tutorial.mp4': { type: 'file', icon: 'üé¨' }
        }
      },
      'Local Disk (C:)': {
        type: 'folder',
        icon: 'üíø',
        children: {
          'Program Files': { type: 'folder', icon: 'üìÅ' },
          'Users': { type: 'folder', icon: 'üìÅ' },
          'Windows': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (C:)/Program Files': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Microsoft': { type: 'folder', icon: 'üìÅ' },
          'Common Files': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (C:)/Program Files/Microsoft': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Edge': { type: 'folder', icon: 'üìÅ' },
          'Office': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (C:)/Program Files/Microsoft/Edge': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'msedge.exe': { type: 'file', icon: 'üåê' }
        }
      },
      'Local Disk (C:)/Program Files/Microsoft/Office': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'WINWORD.EXE': { type: 'file', icon: 'üíº' },
          'EXCEL.EXE': { type: 'file', icon: 'üìä' }
        }
      },
      'Local Disk (C:)/Program Files/Common Files': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'shared.dll': { type: 'file', icon: '‚öôÔ∏è' }
        }
      },
      'Local Disk (C:)/Users': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Shalom': { type: 'folder', icon: 'üë§' },
          'Public': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (C:)/Users/Shalom': {
        type: 'folder',
        icon: 'üë§',
        children: {
          'Desktop': { type: 'folder', icon: 'üìÅ' },
          'Documents': { type: 'folder', icon: 'üìÑ' },
          'Downloads': { type: 'folder', icon: '‚¨áÔ∏è' }
        }
      },
      'Local Disk (C:)/Users/Shalom/Desktop': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'shortcut.lnk': { type: 'file', icon: 'üîó' }
        }
      },
      'Local Disk (C:)/Users/Shalom/Documents': {
        type: 'folder',
        icon: 'üìÑ',
        children: {
          'file.docx': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Local Disk (C:)/Users/Shalom/Downloads': {
        type: 'folder',
        icon: '‚¨áÔ∏è',
        children: {
          'setup.exe': { type: 'file', icon: 'üíø' }
        }
      },
      'Local Disk (C:)/Users/Public': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Public Documents': { type: 'folder', icon: 'üìÑ' }
        }
      },
      'Local Disk (C:)/Users/Public/Public Documents': {
        type: 'folder',
        icon: 'üìÑ',
        children: {
          'readme.txt': { type: 'file', icon: 'üìÑ' }
        }
      },
      'Local Disk (C:)/Windows': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'System32': { type: 'folder', icon: 'üìÅ' },
          'Fonts': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (C:)/Windows/System32': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'cmd.exe': { type: 'file', icon: '‚¨õ' },
          'notepad.exe': { type: 'file', icon: 'üìù' }
        }
      },
      'Local Disk (C:)/Windows/Fonts': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'arial.ttf': { type: 'file', icon: 'üî§' },
          'times.ttf': { type: 'file', icon: 'üî§' }
        }
      },
      'Local Disk (D:)': {
        type: 'folder',
        icon: 'üíø',
        children: {
          'Games': { type: 'folder', icon: 'üéÆ' },
          'Backup': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (D:)/Games': {
        type: 'folder',
        icon: 'üéÆ',
        children: {
          'Steam': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (D:)/Games/Steam': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'steamapps': { type: 'folder', icon: 'üìÅ' },
          'steam.exe': { type: 'file', icon: 'üéÆ' }
        }
      },
      'Local Disk (D:)/Games/Steam/steamapps': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'common': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (D:)/Games/Steam/steamapps/common': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'Game1': { type: 'folder', icon: 'üéÆ' },
          'Game2': { type: 'folder', icon: 'üéÆ' }
        }
      },
      'Local Disk (D:)/Games/Steam/steamapps/common/Game1': {
        type: 'folder',
        icon: 'üéÆ',
        children: {
          'game.exe': { type: 'file', icon: 'üéÆ' },
          'config.ini': { type: 'file', icon: '‚öôÔ∏è' }
        }
      },
      'Local Disk (D:)/Games/Steam/steamapps/common/Game2': {
        type: 'folder',
        icon: 'üéÆ',
        children: {
          'launcher.exe': { type: 'file', icon: 'üéÆ' }
        }
      },
      'Local Disk (D:)/Backup': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          '2024': { type: 'folder', icon: 'üìÅ' },
          '2023': { type: 'folder', icon: 'üìÅ' }
        }
      },
      'Local Disk (D:)/Backup/2024': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'backup-jan.zip': { type: 'file', icon: 'üì¶' },
          'backup-feb.zip': { type: 'file', icon: 'üì¶' }
        }
      },
      'Local Disk (D:)/Backup/2023': {
        type: 'folder',
        icon: 'üìÅ',
        children: {
          'full-backup.zip': { type: 'file', icon: 'üì¶' }
        }
      }
    };

    let currentPath = 'This PC';
    let historyStack = ['This PC'];
    let historyIndex = 0;

    function renderExplorer(path) {
      const content = document.getElementById('explorerContent');
      const pathDisplay = document.getElementById('pathDisplay');
      const folder = fileSystem[path];
      
      content.innerHTML = '';
      pathDisplay.textContent = path;
      
      // Update sidebar active state
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.location === path.split('/')[0]) {
          item.classList.add('active');
        }
      });

      // Update navigation buttons
      document.getElementById('backBtn').classList.toggle('disabled', historyIndex <= 0);
      document.getElementById('forwardBtn').classList.toggle('disabled', historyIndex >= historyStack.length - 1);

      if (!folder || !folder.children) {
        content.innerHTML = '<div style="color: #888; padding: 20px;">This folder is empty</div>';
        return;
      }

      Object.keys(folder.children).forEach(name => {
        const item = folder.children[name];
        const div = document.createElement('div');
        div.className = 'folder-item';
        div.innerHTML = `<div style="font-size: 40px;">${item.icon}</div><span>${name}</span>`;
        
        if (item.type === 'folder' || item.type === 'drive') {
          div.ondblclick = () => {
            const newPath = path === 'This PC' ? name : `${path}/${name}`;
            navigateTo(newPath, true);
          };
        } else {
          div.ondblclick = () => {
            // Open file action (could be extended)
            alert(`◊§◊ï◊™◊ó ◊ß◊ï◊ë◊•: ${name}`);
          };
        }
        
        div.onclick = (e) => {
          document.querySelectorAll('.folder-item').forEach(f => f.classList.remove('selected'));
          div.classList.add('selected');
        };
        
        content.appendChild(div);
      });
    }

    function navigateTo(path, addToHistory = true) {
      if (addToHistory && path !== currentPath) {
        // Remove forward history if navigating to new path
        historyStack = historyStack.slice(0, historyIndex + 1);
        historyStack.push(path);
        historyIndex = historyStack.length - 1;
      }
      currentPath = path;
      renderExplorer(path);
    }

    function goBack() {
      if (historyIndex > 0) {
        historyIndex--;
        currentPath = historyStack[historyIndex];
        renderExplorer(currentPath);
      }
    }

    function goForward() {
      if (historyIndex < historyStack.length - 1) {
        historyIndex++;
        currentPath = historyStack[historyIndex];
        renderExplorer(currentPath);
      }
    }

    function refreshExplorer() {
      renderExplorer(currentPath);
    }

    // Store original openWindow
    const baseOpenWindow = openWindow;

    // ====== BROWSER FUNCTIONS ======
    let browserHistory = ['https://www.google.com/webhp?igu=1'];
    let browserHistoryIndex = 0;

    function browserNavigate(url) {
      const urlInput = document.getElementById('browserUrl');
      const frame = document.getElementById('browserFrame');
      const loading = document.getElementById('browserLoading');
      
      let targetUrl = url || urlInput.value.trim();
      
      // Add https:// if missing
      if (targetUrl && !targetUrl.startsWith('http://') && !targetUrl.startsWith('https://')) {
        // Check if it's a search query or a URL
        if (targetUrl.includes('.') && !targetUrl.includes(' ')) {
          targetUrl = 'https://' + targetUrl;
        } else {
          // Use Google search
          targetUrl = 'https://www.google.com/search?igu=1&q=' + encodeURIComponent(targetUrl);
        }
      }
      
      urlInput.value = targetUrl;
      
      // Show loading
      loading.style.display = 'block';
      
      // Update history
      if (targetUrl !== browserHistory[browserHistoryIndex]) {
        browserHistory = browserHistory.slice(0, browserHistoryIndex + 1);
        browserHistory.push(targetUrl);
        browserHistoryIndex = browserHistory.length - 1;
      }
      
      // Navigate
      frame.src = targetUrl;
      
      // Update tab title
      updateTabTitle(targetUrl);
      
      // Hide loading after a delay
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1500);
    }

    function browserBack() {
      if (browserHistoryIndex > 0) {
        browserHistoryIndex--;
        const url = browserHistory[browserHistoryIndex];
        document.getElementById('browserUrl').value = url;
        document.getElementById('browserFrame').src = url;
        updateTabTitle(url);
      }
    }

    function browserForward() {
      if (browserHistoryIndex < browserHistory.length - 1) {
        browserHistoryIndex++;
        const url = browserHistory[browserHistoryIndex];
        document.getElementById('browserUrl').value = url;
        document.getElementById('browserFrame').src = url;
        updateTabTitle(url);
      }
    }

    function browserRefresh() {
      const frame = document.getElementById('browserFrame');
      const loading = document.getElementById('browserLoading');
      loading.style.display = 'block';
      frame.src = frame.src;
      setTimeout(() => {
        loading.style.display = 'none';
      }, 1500);
    }

    function browserHome() {
      const homeUrl = 'https://www.google.com/webhp?igu=1';
      document.getElementById('browserUrl').value = homeUrl;
      browserNavigate(homeUrl);
    }

    function updateTabTitle(url) {
      const tabTitle = document.getElementById('tabTitle');
      const tabIcon = document.getElementById('tabIcon');
      
      try {
        const hostname = new URL(url).hostname.replace('www.', '');
        tabTitle.textContent = hostname || 'New Tab';
        
        // Set icon based on site
        if (url.includes('google')) {
          tabIcon.textContent = 'üîç';
        } else if (url.includes('youtube')) {
          tabIcon.textContent = '‚ñ∂Ô∏è';
        } else if (url.includes('github')) {
          tabIcon.textContent = 'üêô';
        } else if (url.includes('wikipedia')) {
          tabIcon.textContent = 'üìö';
        } else {
          tabIcon.textContent = 'üåê';
        }
      } catch (e) {
        tabTitle.textContent = 'New Tab';
        tabIcon.textContent = 'üåê';
      }
    }

    // Quick site navigation
    function goToSite(url) {
      document.getElementById('browserUrl').value = url;
      browserNavigate(url);
    }

    // ====== CALENDAR ======
    let currentCalendarDate = new Date();
    
    function toggleCalendar() {
      document.getElementById('quickSettings').classList.remove('open');
      document.getElementById('calendarPopup').classList.toggle('open');
      renderCalendar();
    }

    function renderCalendar() {
      const grid = document.getElementById('calendarGrid');
      const monthLabel = document.getElementById('calendarMonth');
      const year = currentCalendarDate.getFullYear();
      const month = currentCalendarDate.getMonth();
      
      monthLabel.textContent = new Date(year, month).toLocaleDateString('he-IL', { month: 'long', year: 'numeric' });
      
      grid.innerHTML = '';
      const days = ['◊ê', '◊ë', '◊í', '◊ì', '◊î', '◊ï', '◊©'];
      days.forEach(d => grid.innerHTML += `<div class="calendar-day header">${d}</div>`);
      
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      
      for (let i = 0; i < firstDay; i++) {
        const prevDays = new Date(year, month, 0).getDate();
        grid.innerHTML += `<div class="calendar-day other-month">${prevDays - firstDay + i + 1}</div>`;
      }
      
      for (let i = 1; i <= daysInMonth; i++) {
        const isToday = today.getDate() === i && today.getMonth() === month && today.getFullYear() === year;
        grid.innerHTML += `<div class="calendar-day${isToday ? ' today' : ''}">${i}</div>`;
      }
    }

    function changeMonth(delta) {
      currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
      renderCalendar();
    }

    // ====== QUICK SETTINGS ======
    function toggleQuickSettings() {
      document.getElementById('calendarPopup').classList.remove('open');
      document.getElementById('quickSettings').classList.toggle('open');
    }

    function updateVolume(val) {
      document.getElementById('volumeVal').textContent = val + '%';
      const icon = document.getElementById('volumeIcon');
      if (val == 0) icon.textContent = 'üîá';
      else if (val < 50) icon.textContent = 'üîâ';
      else icon.textContent = 'üîä';
    }

    document.getElementById('brightnessSlider')?.addEventListener('input', function() {
      document.getElementById('brightnessVal').textContent = this.value + '%';
    });

    // ====== WIDGETS ======
    function toggleWidgets() {
      document.getElementById('widgetsPanel').classList.toggle('open');
    }

    // ====== WINDOW MANAGEMENT ======
    let windowStates = {};
    let openWindows = new Set();

    function minimizeWindow(name) {
      const win = document.getElementById(name + 'Window');
      if (win) {
        win.classList.add('minimized');
        updateTaskbar();
      }
    }

    function maximizeWindow(name) {
      const win = document.getElementById(name + 'Window');
      if (win) {
        if (win.classList.contains('maximized')) {
          win.classList.remove('maximized');
          if (windowStates[name]) {
            win.style.top = windowStates[name].top;
            win.style.left = windowStates[name].left;
            win.style.width = windowStates[name].width;
            win.style.height = windowStates[name].height;
          }
        } else {
          windowStates[name] = {
            top: win.style.top,
            left: win.style.left,
            width: win.style.width,
            height: win.style.height
          };
          win.classList.add('maximized');
        }
      }
    }

    // Comprehensive openWindow override
    openWindow = function(name) {
      const win = document.getElementById(name + 'Window');
      if (win) {
        win.classList.remove('minimized');
        openWindows.add(name);
        updateTaskbar();
      }
      baseOpenWindow(name);
      
      // Initialize specific windows
      if (name === 'explorer') {
        renderExplorer(currentPath);
        renderExplorerTabs();
      }
      if (name === 'paint') initPaint();
      if (name === 'taskmanager') updateTaskManager();
      if (name === 'photos') loadPhotos();
      if (name === 'mediaplayer') loadMediaPlaylist();
    };

    // Override closeWindow
    const baseCloseWindow = closeWindow;
    closeWindow = function(name) {
      openWindows.delete(name);
      updateTaskbar();
      baseCloseWindow(name);
    };

    function updateTaskbar() {
      const apps = ['edge', 'explorer', 'terminal', 'notepad'];
      apps.forEach(app => {
        const btn = document.getElementById('taskbar-' + app);
        if (btn) {
          const win = document.getElementById(app + 'Window');
          if (win && win.classList.contains('open') && !win.classList.contains('minimized')) {
            btn.classList.add('running');
          } else {
            btn.classList.remove('running');
          }
        }
      });
    }

    // ====== CALCULATOR ======
    let calcValue = '0';
    let calcOperator = null;
    let calcPrevValue = null;
    let calcNewNumber = true;

    function calcInput(val) {
      if (['+', '-', '*', '/'].includes(val)) {
        calcOperator = val;
        calcPrevValue = parseFloat(calcValue);
        calcNewNumber = true;
      } else if (val === '%') {
        calcValue = (parseFloat(calcValue) / 100).toString();
      } else if (val === '¬±') {
        calcValue = (parseFloat(calcValue) * -1).toString();
      } else {
        if (calcNewNumber) {
          calcValue = val;
          calcNewNumber = false;
        } else {
          calcValue = calcValue === '0' ? val : calcValue + val;
        }
      }
      document.getElementById('calcDisplay').textContent = calcValue;
    }

    function calcResult() {
      if (calcOperator && calcPrevValue !== null) {
        const current = parseFloat(calcValue);
        let result;
        switch (calcOperator) {
          case '+': result = calcPrevValue + current; break;
          case '-': result = calcPrevValue - current; break;
          case '*': result = calcPrevValue * current; break;
          case '/': result = calcPrevValue / current; break;
        }
        calcValue = result.toString();
        document.getElementById('calcDisplay').textContent = calcValue;
        calcOperator = null;
        calcPrevValue = null;
        calcNewNumber = true;
      }
    }

    function clearCalc() {
      calcValue = '0';
      calcOperator = null;
      calcPrevValue = null;
      calcNewNumber = true;
      document.getElementById('calcDisplay').textContent = '0';
    }

    // ====== TERMINAL ======
    const terminalCommands = {
      help: 'Available commands: help, dir, cls, echo, date, time, whoami, ver, color, exit',
      dir: 'Directory of C:\\Users\\Shalom\n\n  Desktop\n  Documents\n  Downloads\n  Music\n  Pictures\n  Videos\n\n  6 Dir(s)',
      cls: 'CLEAR',
      whoami: 'Shalom',
      ver: 'Microsoft Windows [Version 10.0.22631.2861]',
      date: () => new Date().toLocaleDateString(),
      time: () => new Date().toLocaleTimeString(),
      exit: 'Closing terminal...'
    };

    function executeCommand() {
      const input = document.getElementById('terminalInput');
      const output = document.getElementById('terminalOutput');
      const cmd = input.value.trim().toLowerCase();
      
      output.textContent += `C:\\Users\\Shalom>${input.value}\n`;
      
      if (cmd === 'cls') {
        output.textContent = '';
      } else if (cmd.startsWith('echo ')) {
        output.textContent += cmd.substring(5) + '\n';
      } else if (cmd.startsWith('color ')) {
        const colors = { '0': '#000', '1': '#00f', '2': '#0f0', '3': '#0ff', '4': '#f00', 'a': '#0f0' };
        output.style.color = colors[cmd.substring(6)] || '#fff';
      } else if (terminalCommands[cmd]) {
        const result = typeof terminalCommands[cmd] === 'function' ? terminalCommands[cmd]() : terminalCommands[cmd];
        output.textContent += result + '\n';
        if (cmd === 'exit') setTimeout(() => closeWindow('terminal'), 500);
      } else if (cmd) {
        output.textContent += `'${cmd}' is not recognized as an internal or external command.\n`;
      }
      
      output.textContent += '\n';
      input.value = '';
      output.scrollTop = output.scrollHeight;
    }

    // ====== TASK MANAGER ======
    function updateTaskManager() {
      document.getElementById('cpuUsage').textContent = Math.floor(Math.random() * 40 + 10) + '%';
      document.getElementById('memUsage').textContent = Math.floor(Math.random() * 30 + 50) + '%';
      document.getElementById('diskUsage').textContent = Math.floor(Math.random() * 20 + 5) + '%';

      const tasks = [
        { name: 'System', icon: '‚öôÔ∏è', cpu: '0.1%', mem: '0.2 MB' },
        { name: 'Windows Explorer', icon: 'üìÅ', cpu: '0.5%', mem: '45.2 MB' },
        { name: 'Microsoft Edge', icon: 'üåê', cpu: '2.3%', mem: '312.1 MB' },
        { name: 'Desktop Window Manager', icon: 'üñ•Ô∏è', cpu: '1.2%', mem: '89.5 MB' },
        { name: 'Windows Security', icon: 'üõ°Ô∏è', cpu: '0.0%', mem: '12.4 MB' }
      ];

      const list = document.getElementById('taskList');
      list.innerHTML = tasks.map(t => `
        <div class="task-item">
          <div class="task-info">
            <span>${t.icon}</span>
            <span>${t.name}</span>
          </div>
          <div style="display: flex; gap: 20px; align-items: center;">
            <span style="color: #888; font-size: 12px;">${t.cpu}</span>
            <span style="color: #888; font-size: 12px;">${t.mem}</span>
            <button class="task-end">End task</button>
          </div>
        </div>
      `).join('');
    }

    // ====== PAINT ======
    let paintColor = '#000';
    let paintSize = 2;
    let painting = false;
    let paintCtx = null;

    function initPaint() {
      const canvas = document.getElementById('paintCanvas');
      if (!canvas) return;
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height - 50;
      paintCtx = canvas.getContext('2d');
      paintCtx.fillStyle = '#fff';
      paintCtx.fillRect(0, 0, canvas.width, canvas.height);

      canvas.onmousedown = (e) => { painting = true; paintCtx.beginPath(); };
      canvas.onmouseup = () => painting = false;
      canvas.onmouseout = () => painting = false;
      canvas.onmousemove = (e) => {
        if (!painting) return;
        const rect = canvas.getBoundingClientRect();
        paintCtx.lineWidth = paintSize;
        paintCtx.lineCap = 'round';
        paintCtx.strokeStyle = paintColor;
        paintCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
        paintCtx.stroke();
        paintCtx.beginPath();
        paintCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
      };
    }

    function setPaintColor(color, el) {
      paintColor = color;
      document.querySelectorAll('.paint-color').forEach(c => c.classList.remove('active'));
      el.classList.add('active');
    }

    function setPaintSize(size, el) {
      paintSize = size;
      document.querySelectorAll('.paint-size').forEach(s => s.classList.remove('active'));
      el.classList.add('active');
    }

    function clearCanvas() {
      if (paintCtx) {
        const canvas = document.getElementById('paintCanvas');
        paintCtx.fillStyle = '#fff';
        paintCtx.fillRect(0, 0, canvas.width, canvas.height);
      }
    }

    // ====== SEARCH ======
    function filterApps(query) {
      const apps = document.querySelectorAll('#pinnedApps .app-item');
      apps.forEach(app => {
        const name = app.dataset.name || '';
        const text = app.textContent.toLowerCase();
        app.style.display = (text.includes(query.toLowerCase()) || name.includes(query.toLowerCase())) ? '' : 'none';
      });
    }

    // ====== KEYBOARD SHORTCUTS ======
    let altTabIndex = 0;
    let altTabWindows = [];

    document.addEventListener('keydown', (e) => {
      // Win key
      if (e.key === 'Meta' || (e.key === 'Control' && e.altKey)) {
        toggleStartMenu();
      }
      // Alt+Tab
      if (e.altKey && e.key === 'Tab') {
        e.preventDefault();
        showAltTab();
      }
      // Alt+F4
      if (e.altKey && e.key === 'F4') {
        e.preventDefault();
        const topWindow = getTopWindow();
        if (topWindow) closeWindow(topWindow.replace('Window', ''));
      }
      // Win+L
      if (e.metaKey && e.key === 'l') {
        e.preventDefault();
        lockScreen();
      }
      // Escape
      if (e.key === 'Escape') {
        document.getElementById('startMenu').classList.remove('open');
        document.getElementById('quickSettings').classList.remove('open');
        document.getElementById('calendarPopup').classList.remove('open');
        document.getElementById('altTabSwitcher').classList.remove('open');
        document.getElementById('widgetsPanel').classList.remove('open');
      }
    });

    function getTopWindow() {
      let topZ = 0, topWin = null;
      document.querySelectorAll('.window.open').forEach(w => {
        const z = parseInt(w.style.zIndex) || 0;
        if (z >= topZ) { topZ = z; topWin = w.id; }
      });
      return topWin;
    }

    function showAltTab() {
      altTabWindows = Array.from(document.querySelectorAll('.window.open')).map(w => ({
        id: w.id,
        title: w.querySelector('.window-title')?.textContent || 'Window',
        icon: w.querySelector('.window-title span')?.textContent || 'üìÑ'
      }));
      
      if (altTabWindows.length === 0) return;
      
      altTabIndex = (altTabIndex + 1) % altTabWindows.length;
      const switcher = document.getElementById('altTabSwitcher');
      switcher.innerHTML = altTabWindows.map((w, i) => `
        <div class="alt-tab-item${i === altTabIndex ? ' selected' : ''}" onclick="selectAltTab(${i})">
          <span>${w.icon}</span>
          <small>${w.title}</small>
        </div>
      `).join('');
      switcher.classList.add('open');
      
      setTimeout(() => switcher.classList.remove('open'), 2000);
    }

    function selectAltTab(index) {
      const win = document.getElementById(altTabWindows[index].id);
      if (win) {
        win.classList.remove('minimized');
        bringToFront(win);
      }
      document.getElementById('altTabSwitcher').classList.remove('open');
    }

    // ====== LOCK SCREEN ======
    function lockScreen() {
      document.getElementById('startMenu').classList.remove('open');
      const overlay = document.getElementById('lockOverlay');
      overlay.classList.add('show');
      updateLockOverlayTime();
      
      overlay.onclick = () => {
        overlay.classList.remove('show');
      };
    }

    function updateLockOverlayTime() {
      const now = new Date();
      const time = document.getElementById('lockOverlayTime');
      const date = document.getElementById('lockOverlayDate');
      if (time) time.textContent = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
      if (date) date.textContent = now.toLocaleDateString('he-IL', { weekday: 'long', day: 'numeric', month: 'long' });
    }

    // ====== BSOD EASTER EGG ======
    function triggerBSOD() {
      document.getElementById('startMenu').classList.remove('open');
      document.getElementById('bsodScreen').classList.add('show');
      
      let progress = 0;
      const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(interval);
          setTimeout(() => {
            document.getElementById('bsodScreen').classList.remove('show');
            shutdown();
          }, 1500);
        }
        document.querySelector('.bsod-text').textContent = `We're just collecting some error info, and then we'll restart for you.\n\n${Math.floor(progress)}% complete`;
      }, 500);
    }

    // ====== FILE OPERATIONS ======
    function createNewFolder() {
      const name = prompt('◊©◊ù ◊î◊™◊ô◊ß◊ô◊ô◊î ◊î◊ó◊ì◊©◊î:');
      if (name && fileSystem[currentPath]) {
        fileSystem[currentPath].children[name] = { type: 'folder', icon: 'üìÅ' };
        fileSystem[currentPath + '/' + name] = { type: 'folder', icon: 'üìÅ', children: {} };
        renderExplorer(currentPath);
      }
    }

    function createNewFile() {
      const name = prompt('◊©◊ù ◊î◊ß◊ï◊ë◊• ◊î◊ó◊ì◊©:');
      if (name && fileSystem[currentPath]) {
        fileSystem[currentPath].children[name] = { type: 'file', icon: 'üìÑ' };
        renderExplorer(currentPath);
      }
    }

    // Close popups on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.calendar-popup') && !e.target.closest('.clock')) {
        document.getElementById('calendarPopup').classList.remove('open');
      }
      if (!e.target.closest('.quick-settings') && !e.target.closest('.system-tray')) {
        document.getElementById('quickSettings').classList.remove('open');
      }
      if (!e.target.closest('.widgets-panel') && !e.target.closest('.taskbar-btn')) {
        document.getElementById('widgetsPanel').classList.remove('open');
      }
    });

    // ====== WINDOW RESIZING ======
    let resizingWindow = null;
    let resizeDirection = null;
    let resizeStartX, resizeStartY, resizeStartWidth, resizeStartHeight, resizeStartLeft, resizeStartTop;

    function startResize(e, winId, direction) {
      e.stopPropagation();
      resizingWindow = document.getElementById(winId);
      resizeDirection = direction;
      resizeStartX = e.clientX;
      resizeStartY = e.clientY;
      resizeStartWidth = parseInt(resizingWindow.style.width) || resizingWindow.offsetWidth;
      resizeStartHeight = parseInt(resizingWindow.style.height) || resizingWindow.offsetHeight;
      resizeStartLeft = parseInt(resizingWindow.style.left) || resizingWindow.offsetLeft;
      resizeStartTop = parseInt(resizingWindow.style.top) || resizingWindow.offsetTop;
      bringToFront(resizingWindow);
    }

    document.addEventListener('mousemove', (e) => {
      if (resizingWindow && resizeDirection) {
        const deltaX = e.clientX - resizeStartX;
        const deltaY = e.clientY - resizeStartY;
        let newWidth = resizeStartWidth;
        let newHeight = resizeStartHeight;
        let newLeft = resizeStartLeft;
        let newTop = resizeStartTop;

        if (resizeDirection.includes('e')) newWidth = Math.max(300, resizeStartWidth + deltaX);
        if (resizeDirection.includes('w')) {
          newWidth = Math.max(300, resizeStartWidth - deltaX);
          newLeft = resizeStartLeft + (resizeStartWidth - newWidth);
        }
        if (resizeDirection.includes('s')) newHeight = Math.max(200, resizeStartHeight + deltaY);
        if (resizeDirection.includes('n')) {
          newHeight = Math.max(200, resizeStartHeight - deltaY);
          newTop = resizeStartTop + (resizeStartHeight - newHeight);
        }

        resizingWindow.style.width = newWidth + 'px';
        resizingWindow.style.height = newHeight + 'px';
        resizingWindow.style.left = newLeft + 'px';
        resizingWindow.style.top = newTop + 'px';
      }
    });

    document.addEventListener('mouseup', () => {
      resizingWindow = null;
      resizeDirection = null;
    });

    // ====== SNAP LAYOUTS ======
    function showSnapLayouts(e, winName) {
      const layouts = document.getElementById('snapLayouts');
      layouts.classList.add('show');
      layouts.dataset.window = winName;
    }

    function hideSnapLayouts() {
      document.getElementById('snapLayouts').classList.remove('show');
    }

    function snapWindow(position) {
      const layouts = document.getElementById('snapLayouts');
      const winName = layouts.dataset.window;
      const win = document.getElementById(winName + 'Window');
      if (!win) return;

      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight - 48;
      const halfWidth = screenWidth / 2;
      const halfHeight = screenHeight / 2;

      switch(position) {
        case 'top-left':
          win.style.left = '0px';
          win.style.top = '0px';
          win.style.width = halfWidth + 'px';
          win.style.height = halfHeight + 'px';
          break;
        case 'top-right':
          win.style.left = halfWidth + 'px';
          win.style.top = '0px';
          win.style.width = halfWidth + 'px';
          win.style.height = halfHeight + 'px';
          break;
        case 'bottom-left':
          win.style.left = '0px';
          win.style.top = halfHeight + 'px';
          win.style.width = halfWidth + 'px';
          win.style.height = halfHeight + 'px';
          break;
        case 'bottom-right':
          win.style.left = halfWidth + 'px';
          win.style.top = halfHeight + 'px';
          win.style.width = halfWidth + 'px';
          win.style.height = halfHeight + 'px';
          break;
      }
      win.classList.remove('maximized');
      hideSnapLayouts();
    }

    // ====== TASK VIEW / VIRTUAL DESKTOPS ======
    let currentDesktop = 0;
    const desktops = [{ windows: [] }, { windows: [] }];

    function showTaskView() {
      document.getElementById('taskView').classList.add('show');
    }

    function hideTaskView() {
      document.getElementById('taskView').classList.remove('show');
    }

    function switchDesktop(index) {
      currentDesktop = index;
      document.querySelectorAll('.desktop-thumbnail').forEach((t, i) => {
        t.classList.toggle('active', i === index);
      });
      hideTaskView();
    }

    // ====== CLIPBOARD OPERATIONS ======
    let clipboard = { type: null, items: [], sourcePath: null };

    function clipboardCut() {
      const selected = document.querySelector('.folder-item.selected');
      if (!selected) return;
      clipboard.type = 'cut';
      clipboard.items = [selected.querySelector('span').textContent];
      clipboard.sourcePath = currentPath;
      selected.style.opacity = '0.5';
      showToast('Cut', 'Item copied to clipboard');
      updateContextMenu();
    }

    function clipboardCopy() {
      const selected = document.querySelector('.folder-item.selected');
      if (!selected) return;
      clipboard.type = 'copy';
      clipboard.items = [selected.querySelector('span').textContent];
      clipboard.sourcePath = currentPath;
      showToast('Copied', 'Item copied to clipboard');
      updateContextMenu();
    }

    function clipboardPaste() {
      if (!clipboard.items.length || !clipboard.sourcePath) return;
      const sourceFolder = fileSystem[clipboard.sourcePath];
      if (!sourceFolder || !sourceFolder.children) return;

      clipboard.items.forEach(itemName => {
        const item = sourceFolder.children[itemName];
        if (item) {
          if (clipboard.type === 'cut') {
            delete sourceFolder.children[itemName];
            delete fileSystem[clipboard.sourcePath + '/' + itemName];
          }
          fileSystem[currentPath].children[itemName] = item;
          if (item.type === 'folder') {
            fileSystem[currentPath + '/' + itemName] = fileSystem[clipboard.sourcePath + '/' + itemName] || { type: 'folder', icon: 'üìÅ', children: {} };
          }
        }
      });

      renderExplorer(currentPath);
      clipboard = { type: null, items: [], sourcePath: null };
      showToast('Pasted', 'Item pasted');
      updateContextMenu();
    }

    function updateContextMenu() {
      const selected = document.querySelector('.folder-item.selected');
      document.getElementById('contextCut').style.display = selected ? '' : 'none';
      document.getElementById('contextCopy').style.display = selected ? '' : 'none';
      document.getElementById('contextPaste').style.display = clipboard.items.length ? '' : 'none';
      document.getElementById('contextRename').style.display = selected ? '' : 'none';
      document.getElementById('contextDelete').style.display = selected ? '' : 'none';
      document.getElementById('contextProperties').style.display = selected ? '' : 'none';
    }

    // ====== RENAME FILES ======
    function renameSelectedFile() {
      const selected = document.querySelector('.folder-item.selected');
      if (!selected) return;
      const oldName = selected.querySelector('span').textContent;
      const newName = prompt('◊©◊ù ◊ó◊ì◊©:', oldName);
      if (newName && newName !== oldName && /^[^<>:"/\\|?*]+$/.test(newName)) {
        const folder = fileSystem[currentPath];
        if (folder && folder.children) {
          folder.children[newName] = folder.children[oldName];
          delete folder.children[oldName];
          renderExplorer(currentPath);
          showToast('Renamed', `Renamed to ${newName}`);
        }
      }
    }

    // ====== RECYCLE BIN ======
    if (!fileSystem['Recycle Bin']) {
      fileSystem['Recycle Bin'] = { type: 'folder', icon: 'üóëÔ∏è', children: {} };
    }

    function deleteSelectedFile() {
      const selected = document.querySelector('.folder-item.selected');
      if (!selected) return;
      const itemName = selected.querySelector('span').textContent;
      const folder = fileSystem[currentPath];
      if (!folder || !folder.children || !folder.children[itemName]) return;

      const item = folder.children[itemName];
      const recyclePath = currentPath + '/' + itemName;
      fileSystem['Recycle Bin'].children[itemName + '_' + Date.now()] = { ...item, originalPath: recyclePath };
      delete folder.children[itemName];
      renderExplorer(currentPath);
      updateRecycleBinBadge();
      showToast('Deleted', 'Item moved to Recycle Bin');
    }

    function updateRecycleBinBadge() {
      const count = Object.keys(fileSystem['Recycle Bin'].children || {}).length;
      const binIcon = document.querySelector('.icon:has(.icon-img:contains("üóëÔ∏è"))');
      if (binIcon && count > 0) {
        binIcon.setAttribute('data-badge', count);
      }
    }

    // ====== DRAG & DROP ======
    let draggedItem = null;

    document.addEventListener('dragstart', (e) => {
      if (e.target.closest('.folder-item')) {
        draggedItem = e.target.closest('.folder-item');
        e.dataTransfer.effectAllowed = 'move';
      }
    });

    document.addEventListener('dragover', (e) => {
      if (e.target.closest('.folder-item') || e.target.closest('.explorer-content')) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        if (e.target.closest('.folder-item')) {
          e.target.closest('.folder-item').style.background = 'rgba(0,120,212,0.3)';
        }
      }
    });

    document.addEventListener('dragleave', (e) => {
      if (e.target.closest('.folder-item')) {
        e.target.closest('.folder-item').style.background = '';
      }
    });

    document.addEventListener('drop', (e) => {
      e.preventDefault();
      if (e.target.closest('.folder-item')) {
        e.target.closest('.folder-item').style.background = '';
        const targetName = e.target.closest('.folder-item').querySelector('span').textContent;
        const targetPath = currentPath === 'This PC' ? targetName : currentPath + '/' + targetName;
        if (draggedItem && fileSystem[targetPath]) {
          const itemName = draggedItem.querySelector('span').textContent;
          const folder = fileSystem[currentPath];
          if (folder && folder.children && folder.children[itemName]) {
            const item = folder.children[itemName];
            fileSystem[targetPath].children[itemName] = item;
            delete folder.children[itemName];
            renderExplorer(currentPath);
            showToast('Moved', `Moved to ${targetName}`);
          }
        }
      }
      draggedItem = null;
    });

    // ====== TOAST NOTIFICATIONS ======
    function showToast(title, message, icon = '‚ÑπÔ∏è') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <div class="toast-close" onclick="this.parentElement.remove()">‚úï</div>
      `;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }

    // ====== DARK/LIGHT MODE ======
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      showToast('Theme Changed', `Switched to ${newTheme} mode`);
    }

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      document.documentElement.setAttribute('data-theme', savedTheme);
    }

    // ====== SCREENSAVER ======
    let inactivityTimer = null;
    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      document.getElementById('screensaver').classList.remove('active');
      inactivityTimer = setTimeout(() => {
        document.getElementById('screensaver').classList.add('active');
      }, 120000); // 2 minutes
    }
    resetInactivityTimer();
    document.addEventListener('mousemove', resetInactivityTimer);
    document.addEventListener('keydown', resetInactivityTimer);
    document.getElementById('screensaver').addEventListener('click', () => {
      document.getElementById('screensaver').classList.remove('active');
      resetInactivityTimer();
    });

    // ====== TOOLTIPS ======
    let tooltipTimeout = null;
    document.addEventListener('mouseover', (e) => {
      const target = e.target;
      const title = target.getAttribute('title');
      if (title) {
        tooltipTimeout = setTimeout(() => {
          const tooltip = document.createElement('div');
          tooltip.className = 'tooltip show';
          tooltip.textContent = title;
          document.body.appendChild(tooltip);
          const rect = target.getBoundingClientRect();
          tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
          tooltip.style.top = rect.top - tooltip.offsetHeight - 8 + 'px';
          target._tooltip = tooltip;
        }, 500);
      }
    });

    document.addEventListener('mouseout', (e) => {
      clearTimeout(tooltipTimeout);
      if (e.target._tooltip) {
        e.target._tooltip.remove();
        e.target._tooltip = null;
      }
    });

    // ====== LOADING ANIMATIONS ======
    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('show');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('show');
    }


    // ====== EXPLORER TABS ======
    let explorerTabs = [{ path: 'This PC', history: ['This PC'], historyIndex: 0 }];
    let activeTabIndex = 0;

    function newExplorerTab() {
      explorerTabs.push({ path: 'This PC', history: ['This PC'], historyIndex: 0 });
      activeTabIndex = explorerTabs.length - 1;
      renderExplorerTabs();
      renderExplorer('This PC');
    }

    function switchExplorerTab(index) {
      activeTabIndex = index;
      const tab = explorerTabs[index];
      currentPath = tab.path;
      historyStack = tab.history;
      historyIndex = tab.historyIndex;
      renderExplorerTabs();
      renderExplorer(tab.path);
    }

    function renderExplorerTabs() {
      const tabsContainer = document.getElementById('explorerTabs');
      tabsContainer.innerHTML = explorerTabs.map((tab, i) => `
        <div class="explorer-tab ${i === activeTabIndex ? 'active' : ''}" onclick="switchExplorerTab(${i})">
          <span>üìÅ</span>
          <span>${tab.path.split('/').pop()}</span>
          ${explorerTabs.length > 1 ? `<span class="explorer-tab-close" onclick="closeExplorerTab(${i}); event.stopPropagation();">‚úï</span>` : ''}
        </div>
      `).join('');
      tabsContainer.style.display = explorerTabs.length > 1 ? 'flex' : 'none';
    }

    function closeExplorerTab(index) {
      if (explorerTabs.length <= 1) return;
      explorerTabs.splice(index, 1);
      if (activeTabIndex >= explorerTabs.length) activeTabIndex = explorerTabs.length - 1;
      const tab = explorerTabs[activeTabIndex];
      currentPath = tab.path;
      historyStack = tab.history;
      historyIndex = tab.historyIndex;
      renderExplorerTabs();
      renderExplorer(tab.path);
    }

    // Update navigateTo to save tab state
    const originalNavigateTo = navigateTo;
    navigateTo = function(path, addToHistory = true) {
      originalNavigateTo(path, addToHistory);
      if (explorerTabs[activeTabIndex]) {
        explorerTabs[activeTabIndex].path = currentPath;
        explorerTabs[activeTabIndex].history = [...historyStack];
        explorerTabs[activeTabIndex].historyIndex = historyIndex;
      }
    };

    // ====== PREVIEW PANE ======
    let previewPaneVisible = false;

    function togglePreviewPane() {
      previewPaneVisible = !previewPaneVisible;
      const pane = document.getElementById('previewPane');
      const toggle = document.getElementById('previewToggle');
      pane.classList.toggle('show', previewPaneVisible);
      toggle.style.background = previewPaneVisible ? 'rgba(0,120,212,0.3)' : '';
    }

    // Update folder item click to show preview
    const originalRenderExplorer = renderExplorer;
    renderExplorer = function(path) {
      originalRenderExplorer(path);
      document.querySelectorAll('.folder-item').forEach(item => {
        item.onclick = (e) => {
          document.querySelectorAll('.folder-item').forEach(f => f.classList.remove('selected'));
          item.classList.add('selected');
          updateContextMenu();
          if (previewPaneVisible) {
            const name = item.querySelector('span').textContent;
            const folder = fileSystem[path];
            if (folder && folder.children && folder.children[name]) {
              const fileItem = folder.children[name];
              const preview = document.getElementById('previewContent');
              if (fileItem.type === 'file') {
                if (name.match(/\.(jpg|jpeg|png|gif)$/i)) {
                  preview.innerHTML = `<img src="https://via.placeholder.com/300x200?text=${name}" class="preview-image" alt="${name}">`;
                } else {
                  preview.innerHTML = `<div class="preview-text">File: ${name}\nType: ${fileItem.type}\nIcon: ${fileItem.icon}</div>`;
                }
              } else {
                preview.innerHTML = `<div class="preview-text">Folder: ${name}\nType: ${fileItem.type}</div>`;
              }
            }
          }
        };
      });
    };

    // ====== PROPERTIES DIALOG ======
    function showProperties() {
      const selected = document.querySelector('.folder-item.selected');
      if (!selected) return;
      const name = selected.querySelector('span').textContent;
      const folder = fileSystem[currentPath];
      if (!folder || !folder.children || !folder.children[name]) return;

      const item = folder.children[name];
      const dialog = document.getElementById('propertiesDialog');
      const icon = document.getElementById('propertiesIcon');
      const dialogName = document.getElementById('propertiesName');
      const content = document.getElementById('propertiesContent');

      icon.textContent = item.icon;
      dialogName.textContent = name;
      content.innerHTML = `
        <div class="properties-row"><span class="properties-label">Type:</span><span class="properties-value">${item.type}</span></div>
        <div class="properties-row"><span class="properties-label">Size:</span><span class="properties-value">${item.type === 'file' ? Math.floor(Math.random() * 1000) + ' KB' : '-'}</span></div>
        <div class="properties-row"><span class="properties-label">Location:</span><span class="properties-value">${currentPath}</span></div>
        <div class="properties-row"><span class="properties-label">Created:</span><span class="properties-value">${new Date().toLocaleDateString()}</span></div>
        <div class="properties-row"><span class="properties-label">Modified:</span><span class="properties-value">${new Date().toLocaleDateString()}</span></div>
      `;
      dialog.classList.add('show');
    }

    // ====== PHOTOS APP ======
    let currentPhotoIndex = 0;
    let photoList = [];

    function loadPhotos() {
      const grid = document.getElementById('photosGrid');
      photoList = [];
      Object.keys(fileSystem).forEach(path => {
        const folder = fileSystem[path];
        if (folder && folder.children) {
          Object.keys(folder.children).forEach(name => {
            if (name.match(/\.(jpg|jpeg|png|gif)$/i)) {
              photoList.push({ name, path, icon: folder.children[name].icon });
            }
          });
        }
      });

      grid.innerHTML = photoList.map((photo, i) => `
        <div class="photo-thumb" onclick="openPhoto(${i})">
          <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 48px;">${photo.icon}</div>
        </div>
      `).join('');
    }

    function openPhoto(index) {
      currentPhotoIndex = index;
      const viewer = document.getElementById('photoViewer');
      const img = document.getElementById('photoViewerImg');
      img.src = `https://via.placeholder.com/800x600?text=${photoList[index].name}`;
      viewer.classList.add('show');
    }

    function prevPhoto() {
      currentPhotoIndex = (currentPhotoIndex - 1 + photoList.length) % photoList.length;
      openPhoto(currentPhotoIndex);
    }

    function nextPhoto() {
      currentPhotoIndex = (currentPhotoIndex + 1) % photoList.length;
      openPhoto(currentPhotoIndex);
    }

    function closePhotoViewer() {
      document.getElementById('photoViewer').classList.remove('show');
    }


    // ====== MEDIA PLAYER ======
    let mediaPlaylist = [];
    let currentMediaIndex = 0;
    let isPlaying = false;

    function loadMediaPlaylist() {
      mediaPlaylist = [];
      Object.keys(fileSystem).forEach(path => {
        const folder = fileSystem[path];
        if (folder && folder.children) {
          Object.keys(folder.children).forEach(name => {
            if (name.match(/\.(mp3|mp4|wav|avi|mov)$/i)) {
              mediaPlaylist.push({ name, path, icon: folder.children[name].icon });
            }
          });
        }
      });
    }

    function togglePlayPause() {
      const video = document.getElementById('mediaPlayerVideo');
      const audio = document.getElementById('mediaPlayerAudio');
      const btn = document.getElementById('playPauseBtn');
      
      if (mediaPlaylist.length === 0) {
        loadMediaPlaylist();
        if (mediaPlaylist.length > 0) {
          currentMediaIndex = 0;
          loadMedia(currentMediaIndex);
        }
      }

      if (video.src) {
        if (isPlaying) {
          video.pause();
          btn.textContent = '‚ñ∂';
        } else {
          video.play();
          btn.textContent = '‚è∏';
        }
        isPlaying = !isPlaying;
      }
    }

    function loadMedia(index) {
      if (index < 0 || index >= mediaPlaylist.length) return;
      currentMediaIndex = index;
      const media = mediaPlaylist[index];
      const video = document.getElementById('mediaPlayerVideo');
      video.src = `https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4`;
      video.load();
    }

    function prevTrack() {
      loadMedia((currentMediaIndex - 1 + mediaPlaylist.length) % mediaPlaylist.length);
    }

    function nextTrack() {
      loadMedia((currentMediaIndex + 1) % mediaPlaylist.length);
    }

    function seekMedia(e) {
      const video = document.getElementById('mediaPlayerVideo');
      const rect = e.currentTarget.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      video.currentTime = percent * video.duration;
    }

    function setMediaVolume(val) {
      const video = document.getElementById('mediaPlayerVideo');
      video.volume = val / 100;
    }

    // ====== SNIPPING TOOL ======
    let snippingStartX, snippingStartY, snippingActive = false;

    function startSnipping() {
      const overlay = document.getElementById('snippingOverlay');
      overlay.classList.add('active');
      snippingActive = true;
    }

    document.getElementById('snippingOverlay').addEventListener('mousedown', (e) => {
      snippingStartX = e.clientX;
      snippingStartY = e.clientY;
      const selection = document.getElementById('snippingSelection');
      selection.style.left = snippingStartX + 'px';
      selection.style.top = snippingStartY + 'px';
      selection.style.width = '0px';
      selection.style.height = '0px';
    });

    document.getElementById('snippingOverlay').addEventListener('mousemove', (e) => {
      if (snippingStartX === undefined) return;
      const selection = document.getElementById('snippingSelection');
      const left = Math.min(snippingStartX, e.clientX);
      const top = Math.min(snippingStartY, e.clientY);
      const width = Math.abs(e.clientX - snippingStartX);
      const height = Math.abs(e.clientY - snippingStartY);
      selection.style.left = left + 'px';
      selection.style.top = top + 'px';
      selection.style.width = width + 'px';
      selection.style.height = height + 'px';
    });

    document.getElementById('snippingOverlay').addEventListener('mouseup', () => {
      const selection = document.getElementById('snippingSelection');
      const rect = selection.getBoundingClientRect();
      if (rect.width > 10 && rect.height > 10) {
        html2canvas(document.body, {
          x: rect.left,
          y: rect.top,
          width: rect.width,
          height: rect.height
        }).then(canvas => {
          const preview = document.getElementById('snippingPreview');
          const img = document.getElementById('snippingPreviewImg');
          img.src = canvas.toDataURL();
          preview.classList.add('show');
          document.getElementById('snippingOverlay').classList.remove('active');
          snippingStartX = undefined;
        }).catch(() => {
          // Fallback: create a placeholder
          const preview = document.getElementById('snippingPreview');
          const img = document.getElementById('snippingPreviewImg');
          img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMmQyZDJkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiNmZmYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5TY3JlZW5zaG90PC90ZXh0Pjwvc3ZnPg==';
          preview.classList.add('show');
          document.getElementById('snippingOverlay').classList.remove('active');
          snippingStartX = undefined;
        });
      }
    });

    function closeSnippingPreview() {
      document.getElementById('snippingPreview').classList.remove('show');
    }

    function copyScreenshot() {
      const img = document.getElementById('snippingPreviewImg');
      img.toBlob(blob => {
        navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })]);
        showToast('Copied', 'Screenshot copied to clipboard');
      });
    }

    function saveScreenshot() {
      showToast('Saved', 'Screenshot saved to Screenshots folder');
      closeSnippingPreview();
    }

    // ====== SETTINGS PAGES ======
    function showSettingsPage(page) {
      document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
      event.target.classList.add('active');
      const content = document.getElementById('settingsContent');
      
      switch(page) {
        case 'personalization':
          content.innerHTML = `
            <h2 style="font-size: 24px; margin: 0;">Personalization</h2>
            <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-top: 15px;">
              <div style="font-size: 14px; margin-bottom: 10px;">Background</div>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <div style="aspect-ratio: 16/9; background: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400') center/cover; border-radius: 4px; cursor: pointer;" onclick="changeWallpaper('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920')"></div>
                <div style="aspect-ratio: 16/9; background: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=400') center/cover; border-radius: 4px; cursor: pointer;" onclick="changeWallpaper('https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1920')"></div>
                <div style="aspect-ratio: 16/9; background: url('https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400') center/cover; border-radius: 4px; cursor: pointer;" onclick="changeWallpaper('https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=1920')"></div>
              </div>
            </div>
            <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-top: 15px;">
              <div style="font-size: 14px; margin-bottom: 10px;">Accent Color</div>
              <div style="display: flex; gap: 10px;">
                <div style="width: 40px; height: 40px; background: #0078d4; border-radius: 50%; cursor: pointer;" onclick="changeAccentColor('#0078d4')"></div>
                <div style="width: 40px; height: 40px; background: #4caf50; border-radius: 50%; cursor: pointer;" onclick="changeAccentColor('#4caf50')"></div>
                <div style="width: 40px; height: 40px; background: #ff9800; border-radius: 50%; cursor: pointer;" onclick="changeAccentColor('#ff9800')"></div>
                <div style="width: 40px; height: 40px; background: #9c27b0; border-radius: 50%; cursor: pointer;" onclick="changeAccentColor('#9c27b0')"></div>
              </div>
            </div>
            <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-top: 15px;">
              <div style="font-size: 14px; margin-bottom: 10px;">Theme</div>
              <button onclick="toggleTheme()" style="padding: 10px 20px; background: #0078d4; border: none; border-radius: 4px; color: white; cursor: pointer;">Toggle Dark/Light Mode</button>
            </div>
          `;
          break;
        case 'system':
          content.innerHTML = `
            <h2 style="font-size: 24px; margin: 0;">System</h2>
            <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; margin-top: 15px;">
              <div style="font-size: 16px; margin-bottom: 15px;">About</div>
              <div class="properties-row"><span class="properties-label">Device name:</span><span class="properties-value">SHALOM-PC</span></div>
              <div class="properties-row"><span class="properties-label">Processor:</span><span class="properties-value">Intel Core i7-13700K</span></div>
              <div class="properties-row"><span class="properties-label">Installed RAM:</span><span class="properties-value">32.0 GB</span></div>
              <div class="properties-row"><span class="properties-label">System type:</span><span class="properties-value">64-bit operating system</span></div>
              <div class="properties-row"><span class="properties-label">Windows version:</span><span class="properties-value">Windows 11 Pro, Version 23H2</span></div>
            </div>
          `;
          break;
        default:
          content.innerHTML = `
            <h2 style="font-size: 24px; margin: 0;">Settings</h2>
            <div style="background: #2d2d2d; padding: 15px; border-radius: 8px;">
              <div style="font-size: 14px;">Windows 11 Pro</div>
              <div style="font-size: 12px; color: #888;">Version 23H2</div>
            </div>
          `;
      }
    }

    function changeWallpaper(url) {
      document.getElementById('desktopContainer').style.background = `url(${url}) center/cover`;
      localStorage.setItem('wallpaper', url);
      showToast('Wallpaper Changed', 'Desktop background updated');
    }

    function changeAccentColor(color) {
      document.documentElement.style.setProperty('--accent-color', color);
      localStorage.setItem('accentColor', color);
      showToast('Accent Color Changed', 'Theme color updated');
    }

    // Load saved wallpaper
    const savedWallpaper = localStorage.getItem('wallpaper');
    if (savedWallpaper) {
      document.getElementById('desktopContainer').style.background = `url(${savedWallpaper}) center/cover`;
    }

    // Load saved accent color
    const savedAccent = localStorage.getItem('accentColor');
    if (savedAccent) {
      document.documentElement.style.setProperty('--accent-color', savedAccent);
    }

    // ====== KEYBOARD SHORTCUTS ======
    document.addEventListener('keydown', (e) => {
      // Ctrl+C
      if (e.ctrlKey && e.key === 'c' && !e.target.matches('input, textarea')) {
        e.preventDefault();
        clipboardCopy();
      }
      // Ctrl+V
      if (e.ctrlKey && e.key === 'v' && !e.target.matches('input, textarea')) {
        e.preventDefault();
        clipboardPaste();
      }
      // Ctrl+X
      if (e.ctrlKey && e.key === 'x' && !e.target.matches('input, textarea')) {
        e.preventDefault();
        clipboardCut();
      }
      // Ctrl+A
      if (e.ctrlKey && e.key === 'a' && e.target.closest('.explorer-content')) {
        e.preventDefault();
        document.querySelectorAll('.folder-item').forEach(item => item.classList.add('selected'));
      }
      // Delete
      if (e.key === 'Delete' && document.querySelector('.folder-item.selected')) {
        e.preventDefault();
        deleteSelectedFile();
      }
      // F2
      if (e.key === 'F2' && document.querySelector('.folder-item.selected')) {
        e.preventDefault();
        renameSelectedFile();
      }
      // F5
      if (e.key === 'F5' && e.target.closest('.explorer-content')) {
        e.preventDefault();
        refreshExplorer();
      }
      // Ctrl+Shift+N
      if (e.ctrlKey && e.shiftKey && e.key === 'N') {
        e.preventDefault();
        createNewFolder();
      }
      // Win+Tab
      if ((e.metaKey || e.ctrlKey) && e.key === 'Tab') {
        e.preventDefault();
        showTaskView();
      }
    });

    // Update context menu on right click
    document.addEventListener('contextmenu', (e) => {
      if (e.target.closest('.folder-item')) {
        setTimeout(updateContextMenu, 10);
      }
    });

    // Start Boot
    setTimeout(typeBios, 500);
  </script>
</body>
</html>
